{"version":3,"file":"script.js","sources":["src/kanban/internal/create-stub.js","src/marker/internal/is-line.js","src/marker/internal/is-overlap.js","src/marker/internal/make-relative-rect.js","src/marker/internal/is-rect.js","src/marker/internal/get-middle-point.js","src/kanban/grid.js","src/category/category.js","src/marker/marker.js","src/kanban/column.js","src/backend.js","src/category/category-stub.js","src/manager/internal/create-stage-stubs.js","src/manager/internal/make-error-message.js","src/manager/manager.js","src/sales.tunnels.js"],"sourcesContent":["import {Tag} from 'main.core';\n\nexport default function createStub()\n{\n\treturn Tag.render`<div class=\"crm-st-kanban-stub\"></div>`;\n}","import {Type} from 'main.core';\n\nexport default function isLine(value)\n{\n\treturn (\n\t\tType.isArray(value)\n\t\t&& value.length === 2\n\t\t&& value.every(Type.isNumber)\n\t);\n}","import isLine from './is-line';\n\nexport default function isOverlap(line1, line2)\n{\n\tif (!isLine(line1) || !isLine(line2))\n\t{\n\t\tthrow new Error('Invalid lines. Line should be Array<number>');\n\t}\n\n\tconst a1 = Math.min(...line1);\n\tconst a2 = Math.max(...line1);\n\n\tconst b1 = Math.min(...line2);\n\tconst b2 = Math.max(...line2);\n\n\treturn a1 >= b1 && a1 <= b2\n\t\t|| a2 >= b1 && a2 <= b2\n\t\t|| b1 >= a1 && b1 <= a2\n\t\t|| b2 >= a1 && b2 <= a2;\n}","import {Type} from 'main.core';\n\nconst isValidRect = rect => (\n\tType.isNumber(rect.left)\n\t&& Type.isNumber(rect.top)\n\t&& Type.isNumber(rect.width)\n\t&& Type.isNumber(rect.height)\n);\n\nexport default function makeRelativeRect(rect1: DOMRect, rect2: DOMRect): DOMRect\n{\n\tif (!isValidRect(rect1) || !isValidRect(rect2))\n\t{\n\t\tthrow new Error('Invalid rect. Rect should includes x, y, width and height props with a number value');\n\t}\n\n\treturn {\n\t\tleft: rect2.left - rect1.left,\n\t\ttop: rect2.top - rect1.top,\n\t\tright: (rect2.left - rect1.left) + rect2.width,\n\t\tbottom: (rect2.top - rect1.top) + rect2.height,\n\t\twidth: rect2.width,\n\t\theight: rect2.height,\n\t};\n}","import {Type} from 'main.core';\n\nexport default function isRect(value)\n{\n\treturn (\n\t\tType.isNumber(value.left)\n\t\t&& Type.isNumber(value.top)\n\t\t&& Type.isNumber(value.width)\n\t\t&& Type.isNumber(value.height)\n\t);\n}","import isRect from './is-rect';\n\nexport default function getMiddlePoint(rect: DOMRect): {middleX: number, middleY: number}\n{\n\tif (!isRect(rect))\n\t{\n\t\tthrow new Error('Invalid rect. Rect should includes x, y, width and height props with a number value');\n\t}\n\n\treturn {\n\t\tmiddleX: rect.left + (rect.width / 2),\n\t\tmiddleY: rect.top + (rect.height / 2),\n\t}\n}","import {Dom, Event} from 'main.core';\nimport {Kanban} from 'main.kanban';\nimport createStub from './internal/create-stub';\nimport Marker from '../marker/marker';\n\nexport default class Grid extends Kanban.Grid\n{\n\temitter = new Event.EventEmitter();\n\n\tadjustLayout() {}\n\tadjustHeight() {}\n\n\tgetEmptyStub()\n\t{\n\t\treturn createStub();\n\t}\n\n\tgetDropZoneArea()\n\t{\n\t\tconst area = super.getDropZoneArea();\n\t\tDom.addClass(area.getContainer(), 'crm-st-kanban-stub');\n\t\treturn area;\n\t}\n\n\tgetGridContainer()\n\t{\n\t\tconst container = super.getGridContainer();\n\t\tDom.addClass(container, 'crm-st-kanban-grid');\n\t\treturn container;\n\t}\n\n\tgetInnerContainer(): HTMLElement\n\t{\n\t\tconst container = super.getInnerContainer();\n\t\tDom.addClass(container, 'crm-st-kanban-inner');\n\t\treturn container;\n\t}\n\n\tgetOuterContainer(): HTMLElement\n\t{\n\t\tconst container = super.getOuterContainer();\n\t\tDom.addClass(container, 'crm-st-kanban');\n\t\treturn container;\n\t}\n\n\tgetLeftEar(): HTMLElement\n\t{\n\t\treturn createStub();\n\t}\n\n\tgetRightEar(): HTMLElement\n\t{\n\t\treturn createStub();\n\t}\n\n\tonColumnDragStart(column)\n\t{\n\t\tsuper.onColumnDragStart(column);\n\t\tMarker.adjustLinks();\n\t}\n\n\tonColumnDragStop(column)\n\t{\n\t\tsuper.onColumnDragStop(column);\n\t\tthis.emitter.emit('Kanban.Grid:columns:sort');\n\n\t\tsetTimeout(() => {\n\t\t\tMarker.adjustLinks();\n\t\t});\n\n\t\tthis.getColumns().forEach((column) => {\n\t\t\tclearInterval(column.intervalId);\n\t\t});\n\t}\n\n\taddColumn(options): Column | null\n\t{\n\t\tconst column = super.addColumn(options);\n\n\t\tif (column.onChangeHandler)\n\t\t{\n\t\t\tcolumn.onChangeHandler(column);\n\t\t}\n\n\t\treturn column;\n\t}\n}","import {Event, Loc, Tag, Dom, Text, Type, Cache, pos} from 'main.core';\nimport {PopupWindow, PopupWindowButton, PopupWindowButtonLink} from 'main.popup';\nimport type CategoryOptions from '../type/category-options';\nimport Column from '../kanban/column';\nimport Grid from '../kanban/grid';\nimport Marker from '../marker/marker';\n\nexport class Category extends Event.EventEmitter\n{\n\tstatic instances: Array<Category> = [];\n\n\tstatic createGrid(options: {\n\t\trenderTo: HTMLElement,\n\t\tcolumns: Array<Column>,\n\t\teditable?: boolean,\n\t\tcolumnType?: string,\n\t})\n\t{\n\t\treturn new Grid({\n\t\t\trenderTo: options.renderTo,\n\t\t\tcanEditColumn: options.editable === true,\n\t\t\tcanRemoveColumn: options.editable === true,\n\t\t\tcanAddColumn: options.editable === true,\n\t\t\tcanSortColumn: options.editable === true,\n\t\t\tcolumnType: options.columnType || 'BX.Crm.SalesTunnels.Kanban.Column',\n\t\t\tdropzoneType: 'BX.Crm.SalesTunnels.Kanban.DropZone',\n\t\t\tcolumns: options.columns,\n\t\t});\n\t}\n\n\tconstructor(options: CategoryOptions)\n\t{\n\t\tsuper();\n\n\t\tCategory.instances.push(this);\n\n\t\tthis.renderTo = options.renderTo;\n\t\tthis.appContainer = options.appContainer;\n\t\tthis.id = options.id;\n\t\tthis.name = options.name;\n\t\tthis.sort = Number.parseInt(options.sort);\n\t\tthis['default'] = options['default'];\n\t\tthis.generatorsCount = Number(options.generatorsCount);\n\t\tthis.stages = options.stages;\n\t\tthis.robotsSettingsLink = options.robotsSettingsLink.replace('{category}', this.id);\n\t\tthis.generatorSettingsLink = options.generatorSettingsLink;\n\t\tthis.cache = new Cache.MemoryCache();\n\t\tthis.drawed = false;\n\t\tthis.allowWrite = Boolean(options.allowWrite);\n\t\tthis.canEditTunnels = Boolean(options.canEditTunnels);\n\n\t\tif (!options.lazy)\n\t\t{\n\t\t\tthis.draw();\n\t\t}\n\n\t\tif (this.generatorsCount > 0)\n\t\t{\n\t\t\tthis.showGeneratorLinkIcon();\n\t\t}\n\n\t\tconst dragButton = this.getDragButton();\n\t\tdragButton.onbxdragstart = this.onDragStart.bind(this);\n\t\tdragButton.onbxdrag = this.onDrag.bind(this);\n\t\tdragButton.onbxdragstop = this.onDragStop.bind(this);\n\n\t\tjsDD.registerObject(dragButton, 40);\n\t\tthis.adjustRobotsLinkIcon();\n\n\t\tthis.getProgressKanban()\n\t\t\t.emitter\n\t\t\t.subscribe('Kanban.Grid:removeColumn', (event) => {\n\t\t\t\tthis.emit('Category:removeStage', event);\n\t\t\t})\n\t\t\t.subscribe('Kanban.Grid:columns:sort', () => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.emit('Column:sort', {\n\t\t\t\t\t\tcolumns: this.getAllColumns(),\n\t\t\t\t\t});\n\t\t\t\t}, 500);\n\n\t\t\t});\n\t\tthis.getSuccessKanban()\n\t\t\t.emitter\n\t\t\t.subscribe('Kanban.Grid:removeColumn', (event) => {\n\t\t\t\tthis.emit('Category:removeStage', event);\n\t\t\t})\n\t\t\t.subscribe('Kanban.Grid:columns:sort', () => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.emit('Column:sort', {\n\t\t\t\t\t\tcolumns: this.getAllColumns(),\n\t\t\t\t\t});\n\t\t\t\t}, 500);\n\t\t\t});\n\t\tthis.getFailKanban()\n\t\t\t.emitter\n\t\t\t.subscribe('Kanban.Grid:removeColumn', (event) => {\n\t\t\t\tthis.emit('Category:removeStage', event);\n\t\t\t})\n\t\t\t.subscribe('Kanban.Grid:columns:sort', () => {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.emit('Column:sort', {\n\t\t\t\t\t\tcolumns: this.getAllColumns(),\n\t\t\t\t\t});\n\t\t\t\t}, 500);\n\t\t\t});\n\t}\n\n\thasTunnels(): boolean\n\t{\n\t\treturn this.getAllColumns()\n\t\t\t.some(column => column.marker.links.size > 0);\n\t}\n\n\tgetRectArea(): DOMRect | {middle: number}\n\t{\n\t\treturn this.cache.remember('rectArea', () => {\n\t\t\tconst rectArea = pos(this.getContainer());\n\t\t\trectArea.middle = rectArea.top + rectArea.height / 2;\n\n\t\t\treturn rectArea;\n\t\t});\n\t}\n\n\tgetIndex(): number | void\n\t{\n\t\treturn [...this.getContainer().parentNode.querySelectorAll('.crm-st-category')]\n\t\t\t.findIndex((item) => item === this.getContainer());\n\t}\n\n\tgetNextCategorySibling(): ?Category\n\t{\n\t\treturn Category.instances.find((category, index) => {\n\t\t\treturn index > this.getIndex();\n\t\t}) || null;\n\t}\n\n\t/** @private */\n\tonDragStart()\n\t{\n\t\tDom.addClass(this.getContainer(), 'crm-st-category-drag');\n\t\tMarker.removeAllLinks();\n\n\t\tthis.dragOffset = jsDD.start_y - this.getRectArea().top;\n\t\tthis.dragIndex = this.getIndex();\n\t\tthis.dragTargetCategory = this.dragTargetCategory || this;\n\t}\n\n\t/** @private */\n\tonDrag(x, y)\n\t{\n\t\tTag.style(this.getContainer())`\n\t\t\ttransform: translate3d(0px, ${y - this.dragOffset - this.getRectArea().top}px, 0px);\n\t\t`;\n\n\t\tconst categoryHeight = this.getRectArea().height;\n\n\t\tCategory.instances.forEach((category, curIndex) => {\n\t\t\tif (\n\t\t\t\tcategory === this\n\t\t\t\t|| Dom.hasClass(category.getContainer(), 'crm-st-category-stub')\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst categoryContainer = category.getContainer();\n\t\t\tconst categoryRectArea = category.getRectArea();\n\t\t\tconst categoryMiddle = categoryRectArea.middle;\n\n\t\t\tif (\n\t\t\t\ty > categoryMiddle\n\t\t\t\t&& curIndex > this.dragIndex\n\t\t\t\t&& categoryContainer.style.transform !== `translate3d(0px, ${(-categoryHeight)}px, 0px)`\n\t\t\t)\n\t\t\t{\n\t\t\t\tTag.style(categoryContainer)`\n\t\t\t\t\ttransition: 200ms;\n\t\t\t\t\ttransform: translate3d(0px, ${(-categoryHeight)}px, 0px);\n\t\t\t\t`;\n\n\t\t\t\tthis.dragTargetCategory = category.getNextCategorySibling();\n\n\t\t\t\tcategory.cache.delete('rectArea');\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\ty < categoryMiddle\n\t\t\t\t&& curIndex < this.dragIndex\n\t\t\t\t&& categoryContainer.style.transform !== `translate3d(0px, ${categoryHeight}px, 0px)`\n\t\t\t)\n\t\t\t{\n\t\t\t\tTag.style(categoryContainer)`\n\t\t\t\t\ttransition: 200ms;\n\t\t\t\t\ttransform: translate3d(0px, ${(categoryHeight)}px, 0px);\n\t\t\t\t`;\n\n\t\t\t\tthis.dragTargetCategory = category;\n\n\t\t\t\tcategory.cache.delete('rectArea');\n\t\t\t}\n\n\t\t\tconst moveBackTop =\n\t\t\t\ty < categoryMiddle\n\t\t\t\t&& curIndex > this.dragIndex\n\t\t\t\t&& categoryContainer.style.transform !== ''\n\t\t\t\t&& categoryContainer.style.transform !== 'translate3d(0, 0, 0)';\n\n\t\t\tconst moveBackBottom =\n\t\t\t\ty > categoryMiddle\n\t\t\t\t&& curIndex < this.dragIndex\n\t\t\t\t&& categoryContainer.style.transform !== ''\n\t\t\t\t&& categoryContainer.style.transform !== 'translate3d(0, 0, 0)';\n\n\t\t\tif (moveBackBottom || moveBackTop)\n\t\t\t{\n\t\t\t\tTag.style(categoryContainer)`\n\t\t\t\t\ttransition: 200ms;\n\t\t\t\t\ttransform: translate3d(0px, 0px, 0px);\n\t\t\t\t`;\n\n\t\t\t\tthis.dragTargetCategory = category;\n\n\t\t\t\tif (\n\t\t\t\t\t!moveBackTop\n\t\t\t\t\t&& Dom.hasClass(category.getNextCategorySibling(), 'crm-st-category-stub')\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.dragTargetCategory = category.getNextCategorySibling();\n\t\t\t\t}\n\n\t\t\t\tcategory.cache.delete('rectArea');\n\t\t\t}\n\t\t});\n\t}\n\n\t/** @private */\n\tonDragStop()\n\t{\n\t\tDom.removeClass(this.getContainer(), 'crm-st-category-drag');\n\n\t\trequestAnimationFrame(() => {\n\t\t\tMarker.restoreAllLinks();\n\t\t});\n\n\t\tCategory.instances.forEach((category) => {\n\t\t\tTag.style(category.getContainer())`\n\t\t\t\ttransform: null;\n\t\t\t\ttransition: null;\n\t\t\t`;\n\n\t\t\tcategory.cache.delete('rectArea');\n\t\t});\n\n\t\tif (this.dragTargetCategory)\n\t\t{\n\t\t\tDom.insertBefore(this.getContainer(), this.dragTargetCategory.getContainer());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.append(this.getContainer(), this.getContainer().parentElement);\n\t\t}\n\n\t\tconst before = Category.instances.map(item => item.getIndex());\n\t\tCategory.instances.sort((a, b) => a.getIndex() > b.getIndex() ? 1 : -1);\n\t\tconst after = Category.instances.map(item => item.getIndex());\n\n\t\tif (JSON.stringify(before) !== JSON.stringify(after))\n\t\t{\n\t\t\tthis.emit('Category:sort');\n\t\t}\n\t}\n\n\tgetContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-st-category\" data-id=\"${this.id}\">\n\t\t\t\t\t<div class=\"crm-st-category-action\">\n\t\t\t\t\t\t${this.getDragButton()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-st-category-info\">\n\t\t\t\t\t\t${this.getTitleContainer()}\n\t\t\t\t\t\t<div class=\"crm-st-category-info-links\">\n\t\t\t\t\t\t\t<div class=\"crm-st-category-info-links-item\">\n\t\t\t\t\t\t\t\t${this.getRobotsLink()}\n\t\t\t\t\t\t\t\t${this.getRobotsHelpLink()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"crm-st-category-info-links-item\">\n\t\t\t\t\t\t\t\t${this.getGeneratorLink()}\n\t\t\t\t\t\t\t\t${this.getGeneratorHelpLink()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"crm-st-category-stages\">\n\t\t\t\t\t\t${this.getProgressContainer()}\n\t\t\t\t\t\t${this.getSuccessContainer()}\n\t\t\t\t\t\t${this.getFailContainer()}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetRobotsHelpLink()\n\t{\n\t\treturn this.cache.remember('robotsHelpLink', () => {\n\t\t\tconst onClick = () => {\n\t\t\t\tif (top.BX.Helper)\n\t\t\t\t{\n\t\t\t\t\ttop.BX.Helper.show('redirect=detail&code=6908975');\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-category-info-links-help\" \n\t\t\t\t\tonclick=\"${onClick}\"\n\t\t\t\t\ttitle=\"${Text.encode(Loc.getMessage('CRM_ST_ROBOTS_HELP_BUTTON'))}\"\n\t\t\t\t\t> </span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetGeneratorHelpLink()\n\t{\n\t\treturn this.cache.remember('generatorHelpLink', () => {\n\t\t\tconst onClick = () => {\n\t\t\t\tif (top.BX.Helper)\n\t\t\t\t{\n\t\t\t\t\ttop.BX.Helper.show('redirect=detail&code=7530721');\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-category-info-links-help\" \n\t\t\t\t\tonclick=\"${onClick}\"\n\t\t\t\t\ttitle=\"${Text.encode(Loc.getMessage('CRM_ST_GENERATOR_HELP_BUTTON'))}\"\n\t\t\t\t\t> </span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetProgressContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('progressContainer', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-group crm-st-category-stages-group-in-progress\">\n\t\t\t\t\t<div class=\"crm-st-category-stages-group-header\">\n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-header-text\">${\n\t\t\t\t\t\t\tLoc.getMessage('CRM_ST_STAGES_GROUP_IN_PROGRESS')\n\t\t\t\t\t\t}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.getProgressStagesContainer()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetProgressStagesContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('progressStagesContainer', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-list\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetProgressKanban(): Grid\n\t{\n\t\treturn this.cache.remember('progressKanban', () => {\n\t\t\treturn Category.createGrid({\n\t\t\t\trenderTo: this.getProgressStagesContainer(),\n\t\t\t\teditable: this.canEditTunnels,\n\t\t\t\tcolumns: this.stages.P.map((stage) => {\n\t\t\t\t\treturn new Column({\n\t\t\t\t\t\tid: stage.STATUS_ID,\n\t\t\t\t\t\tname: stage.NAME,\n\t\t\t\t\t\tcolor: stage.COLOR.replace('#', ''),\n\t\t\t\t\t\tdata: this.getColumnData(stage),\n\t\t\t\t\t});\n\t\t\t\t}),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetSuccessContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('successContainer', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-group crm-st-category-stages-group-success\">\n\t\t\t\t\t<div class=\"crm-st-category-stages-group-header\">\n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-in-success\"> </span> \n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-header-text\">${\n\t\t\t\t\t\t\tLoc.getMessage('CRM_ST_STAGES_GROUP_SUCCESS')\n\t\t\t\t\t\t}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.getSuccessStagesContainer()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetSuccessStagesContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('successStagesContainer', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-list\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetSuccessKanban(): Grid\n\t{\n\t\treturn this.cache.remember('successKanban', () => {\n\t\t\treturn Category.createGrid({\n\t\t\t\trenderTo: this.getSuccessStagesContainer(),\n\t\t\t\tcanEditColumn: this.canEditTunnels,\n\t\t\t\teditable: this.canEditTunnels,\n\t\t\t\tcanRemoveColumn: this.allowWrite,\n\t\t\t\tcolumns: this.stages.S.map((stage) => {\n\t\t\t\t\treturn new Column({\n\t\t\t\t\t\tid: stage.STATUS_ID,\n\t\t\t\t\t\tname: stage.NAME,\n\t\t\t\t\t\tcolor: stage.COLOR.replace('#', ''),\n\t\t\t\t\t\tdata: this.getColumnData(stage),\n\t\t\t\t\t\tcanRemove: false,\n\t\t\t\t\t\tcanSort: false,\n\t\t\t\t\t});\n\t\t\t\t}),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetFailContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('failContainer', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-group crm-st-category-stages-group-fail\">\n\t\t\t\t\t<div class=\"crm-st-category-stages-group-header\">\n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-in-fail\"> </span> \n\t\t\t\t\t\t<span class=\"crm-st-category-stages-group-header-text\">${\n\t\t\t\t\t\t\tLoc.getMessage('CRM_ST_STAGES_GROUP_FAIL')\n\t\t\t\t\t\t}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.getFailStagesContainer()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetFailStagesContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('failStagesContainer', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-st-category-stages-list\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetFailKanban(): Grid\n\t{\n\t\treturn this.cache.remember('failKanban', () => {\n\t\t\treturn Category.createGrid({\n\t\t\t\trenderTo: this.getFailStagesContainer(),\n\t\t\t\teditable: this.canEditTunnels,\n\t\t\t\tcanEditColumn: this.canEditTunnels,\n\t\t\t\tcanRemoveColumn: this.canEditTunnels,\n\t\t\t\tcolumns: this.stages.F.map((stage) => {\n\t\t\t\t\treturn new Column({\n\t\t\t\t\t\tid: stage.STATUS_ID,\n\t\t\t\t\t\tname: stage.NAME,\n\t\t\t\t\t\tcolor: stage.COLOR.replace('#', ''),\n\t\t\t\t\t\tdata: this.getColumnData(stage),\n\t\t\t\t\t});\n\t\t\t\t}),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetColumnData(stage)\n\t{\n\t\treturn {\n\t\t\tstageId: stage.ID,\n\t\t\tentityId: stage.ENTITY_ID,\n\t\t\tstage,\n\t\t\tonLink: (link) => {\n\t\t\t\tthis.emit('Column:link', link);\n\t\t\t\tthis.adjustRobotsLinkIcon();\n\t\t\t},\n\t\t\tonRemoveLinkFrom: (link) => {\n\t\t\t\tthis.emit('Column:removeLinkFrom', link);\n\t\t\t\tthis.adjustRobotsLinkIcon();\n\t\t\t},\n\t\t\tonEditLink: (link) => {\n\t\t\t\tthis.emit('Column:editLink', link);\n\t\t\t\tthis.adjustRobotsLinkIcon();\n\t\t\t},\n\t\t\tonNameChange: (column) => {\n\t\t\t\tthis.emit('Column:nameChange', {column});\n\t\t\t},\n\t\t\tonColorChange: (column) => {\n\t\t\t\tthis.emit('Column:colorChange', {column});\n\t\t\t},\n\t\t\tonAddColumn: (column) => {\n\t\t\t\tthis.emit('Column:addColumn', {column});\n\t\t\t},\n\t\t\tonRemove: (event) => {\n\t\t\t\tthis.emit('Column:remove', event);\n\t\t\t},\n\t\t\tonChange: (column) => {\n\t\t\t\tthis.emit('Column:change', {column});\n\t\t\t},\n\t\t\tonSort: () => {\n\t\t\t\tthis.emit('Column:sort', {\n\t\t\t\t\tcolumns: this.getAllColumns(),\n\t\t\t\t});\n\t\t\t},\n\t\t\tonError: (event) => {\n\t\t\t\tthis.emit('Column:error', event);\n\t\t\t},\n\t\t\tcategory: this,\n\t\t\tappContainer: this.appContainer,\n\t\t\tcategoryContainer: this.getFailContainer(),\n\t\t\tstagesGroups: {\n\t\t\t\tprogressStagesGroup: this.getProgressContainer(),\n\t\t\t\tsuccessStagesGroup: this.getSuccessContainer(),\n\t\t\t\tfailStagesGroup: this.getFailContainer(),\n\t\t\t},\n\t\t\tcurrentStageGroup: this.getFailContainer(),\n\t\t\tcategoryName: this.getTitle().innerText,\n\t\t\tcanEditTunnels: this.canEditTunnels,\n\t\t};\n\t}\n\n\tgetRobotsLink(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('robotsLink', () => {\n\t\t\tconst onClick = this.onRobotsLinkClick.bind(this);\n\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"crm-st-category-info-links-link crm-st-robots-link\" onclick=\"${onClick}\">${\n\t\t\t\t\tLoc.getMessage('CRM_ST_ROBOT_SETTINGS_LINK_LABEL')\n\t\t\t\t}</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\t/** @private */\n\tonRobotsLinkClick(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\t// eslint-disable-next-line\n\t\tBX.SidePanel.Instance.open(\n\t\t\tthis.robotsSettingsLink,\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tthis.emit('Category:slider:close');\n\t\t\t\t\t\tthis.emit('Category:slider:robots:close');\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\tgetGeneratorLink(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('generatorLink', () => {\n\t\t\tconst onClick = this.onGeneratorLinkClick.bind(this);\n\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"crm-st-category-info-links-link crm-st-generator-link\" onclick=\"${onClick}\">${\n\t\t\t\t\tLoc.getMessage('CRM_ST_GENERATOR_SETTINGS_LINK_LABEL')\n\t\t\t\t}</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\t/** @private */\n\tonGeneratorLinkClick(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\t// eslint-disable-next-line\n\t\tBX.SidePanel.Instance.open(\n\t\t\tthis.generatorSettingsLink,\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tthis.emit('Category:slider:close');\n\t\t\t\t\t\tthis.emit('Category:slider:generator:close', {category: this});\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\tgetEditButton(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('editButton', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-edit-button\" \n\t\t\t\t\tonmousedown=\"${this.onEditButtonClick.bind(this)}\"\n\t\t\t\t\ttitle=\"${Loc.getMessage('CRM_ST_EDIT_CATEGORY_TITLE')}\"\n\t\t\t\t\t> </span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tactivateEditButton()\n\t{\n\t\tDom.addClass(this.getEditButton(), 'crm-st-edit-button-active');\n\t}\n\n\tdeactivateEditButton()\n\t{\n\t\tDom.removeClass(this.getEditButton(), 'crm-st-edit-button-active');\n\t}\n\n\tonEditButtonClick(event?: MouseEvent)\n\t{\n\t\tif (event)\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t}\n\n\t\tif (this.isTitleEditEnabled())\n\t\t{\n\t\t\tthis.disableTitleEdit();\n\t\t\tthis.saveTitle();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.enableTitleEdit();\n\t}\n\n\tshowTitleEditor(value: ?string = null)\n\t{\n\t\tconst titleEditor = this.getTitleEditor();\n\t\tconst {innerText} = this.getTitle();\n\n\t\ttitleEditor.value = Type.isString(value) ? value : Text.decode(innerText);\n\n\t\tTag.style(titleEditor)`\n\t\t\tdisplay: block;\n\t\t`;\n\t}\n\n\thideTitleEditor()\n\t{\n\t\tconst titleEditor = this.getTitleEditor();\n\n\t\tTag.style(titleEditor)`\n\t\t\tdisplay: null;\n\t\t`;\n\t}\n\n\tfocusOnTitleEditor()\n\t{\n\t\tconst titleEditor = this.getTitleEditor();\n\t\ttitleEditor.focus();\n\n\t\tconst title = this.getTitle();\n\t\tconst titleLength = title.innerText.length;\n\t\ttitleEditor.setSelectionRange(titleLength, titleLength);\n\t}\n\n\tshowTitle()\n\t{\n\t\tTag.style(this.getTitle())`\n\t\t\tdisplay: null;\n\t\t`;\n\t}\n\n\thideTitle()\n\t{\n\t\tTag.style(this.getTitle())`\n\t\t\tdisplay: none;\n\t\t`;\n\t}\n\n\tsaveTitle()\n\t{\n\t\tconst title = this.getTitle();\n\t\tconst titleEditor = this.getTitleEditor();\n\t\tconst {value} = titleEditor;\n\t\tconst safeValue = Text.encode(value.trim()) || Loc.getMessage('CRM_ST_TITLE_EDITOR_PLACEHOLDER');\n\n\t\tif (title.innerHTML !== safeValue)\n\t\t{\n\t\t\ttitle.innerHTML = safeValue;\n\n\t\t\tTag.attrs(title)`\n\t\t\t\ttitle: ${value.trim()};\n\t\t\t`;\n\n\t\t\tthis.emit('Category:title:save', {categoryId: this.id, value: safeValue});\n\t\t}\n\t}\n\n\tenableTitleEdit(value = null)\n\t{\n\t\tthis.hideTitle();\n\t\tthis.showTitleEditor(value);\n\t\tthis.activateEditButton();\n\t\tthis.focusOnTitleEditor();\n\t}\n\n\tdisableTitleEdit()\n\t{\n\t\tthis.showTitle();\n\t\tthis.hideTitleEditor();\n\t\tthis.deactivateEditButton();\n\t}\n\n\tisTitleEditEnabled(): boolean\n\t{\n\t\treturn Dom.hasClass(this.getEditButton(), 'crm-st-edit-button-active');\n\t}\n\n\tgetRemoveButton(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('removeButton', () => {\n\t\t\tconst button = Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-remove-button\" \n\t\t\t\t\tonclick=\"${this.onRemoveButtonClick.bind(this)}\" \n\t\t\t\t\ttitle=\"${Loc.getMessage('CRM_ST_REMOVE_CATEGORY')}\"\n\t\t\t\t\t> </span>\n\t\t\t`;\n\n\t\t\tif (String(this.id) === '0')\n\t\t\t{\n\t\t\t\tTag.style(button)`\n\t\t\t\t\tdisplay: none;\n\t\t\t\t`;\n\t\t\t}\n\n\t\t\treturn button;\n\t\t});\n\t}\n\n\tonRemoveButtonClick()\n\t{\n\t\tthis.showConfirmRemovePopup()\n\t\t\t.then(({confirm}) => {\n\t\t\t\tif (confirm)\n\t\t\t\t{\n\t\t\t\t\tthis.emit('Category:remove', {\n\t\t\t\t\t\tcategoryId: this.id,\n\t\t\t\t\t\tonConfirm: () => {\n\t\t\t\t\t\t\tthis.remove();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\t\tthis.removeBlur();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.removeBlur();\n\t\t\t});\n\n\t\tthis.addBlur();\n\t}\n\n\tgetAllColumns()\n\t{\n\t\tconst progressColumns = this.getProgressKanban()\n\t\t\t.getColumns()\n\t\t\t.sort((a, b) => a.getIndex() > b.getIndex() ? 1 : -1);\n\t\tconst successColumn = this.getSuccessKanban()\n\t\t\t.getColumns()\n\t\t\t.sort((a, b) => a.getIndex() > b.getIndex() ? 1 : -1);\n\t\tconst failColumns = this.getFailKanban()\n\t\t\t.getColumns()\n\t\t\t.sort((a, b) => a.getIndex() > b.getIndex() ? 1 : -1);\n\n\t\treturn [\n\t\t\t...progressColumns,\n\t\t\t...successColumn,\n\t\t\t...failColumns,\n\t\t];\n\t}\n\n\taddBlur()\n\t{\n\t\tDom.addClass(this.getContainer(), 'crm-st-blur');\n\n\t\tthis.getAllColumns().forEach((column) => {\n\t\t\tcolumn.marker.blurLinks();\n\t\t});\n\t}\n\n\tremoveBlur()\n\t{\n\t\tDom.removeClass(this.getContainer(), 'crm-st-blur');\n\n\t\tthis.getAllColumns().forEach((column) => {\n\t\t\tcolumn.marker.unblurLinks();\n\t\t});\n\t}\n\n\tremove()\n\t{\n\t\tDom.remove(this.getContainer());\n\n\t\tMarker.getAllLinks()\n\t\t\t.forEach((link) => {\n\t\t\t\tconst columnFrom = link.from.data.column;\n\t\t\t\tconst categoryFrom = columnFrom.getData().category;\n\t\t\t\tconst columnTo = link.to.data.column;\n\t\t\t\tconst categoryTo = columnTo.getData().category;\n\n\t\t\t\tif (String(categoryFrom.id) === String(this.id))\n\t\t\t\t{\n\t\t\t\t\tlink.from.removeLink(link);\n\t\t\t\t}\n\n\t\t\t\tif (String(categoryTo.id) === String(this.id))\n\t\t\t\t{\n\t\t\t\t\tlink.to.removeLink(link);\n\t\t\t\t}\n\t\t\t});\n\n\t\tMarker.getAllStubLinks()\n\t\t\t.forEach((link) => {\n\t\t\t\tconst columnFrom = link.from.data.column;\n\t\t\t\tconst categoryFrom = columnFrom.getData().category;\n\t\t\t\tconst columnTo = link.to.data.column;\n\t\t\t\tconst categoryTo = columnTo.getData().category;\n\n\t\t\t\tif (String(categoryFrom.id) === String(this.id))\n\t\t\t\t{\n\t\t\t\t\tlink.from.removeStubLink(link);\n\t\t\t\t}\n\n\t\t\t\tif (String(categoryTo.id) === String(this.id))\n\t\t\t\t{\n\t\t\t\t\tlink.to.removeStubLink(link);\n\t\t\t\t}\n\t\t\t});\n\n\t\tCategory.instances = Category.instances.filter(item => item !== this);\n\t}\n\n\tgetTitle(): HTMLHeadingElement\n\t{\n\t\treturn this.cache.remember('title', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<h3 class=\"crm-st-category-info-title\" title=\"${this.name}\">${this.name}</h3>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetTitleEditor(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('titleEditor', () => {\n\t\t\tconst onKeyDown = this.onTitleEditorKeyDown.bind(this);\n\t\t\tconst onBlur = this.onTitleEditorBlur.bind(this);\n\t\t\treturn Tag.render`\n\t\t\t\t<input class=\"crm-st-category-info-title-editor\" \n\t\t\t\t\t onkeydown=\"${onKeyDown}\"\n\t\t\t\t\t onblur=\"${onBlur}\"\n\t\t\t\t\t value=\"${this.name}\"\n\t\t\t\t\t placeholder=\"${Loc.getMessage('CRM_ST_TITLE_EDITOR_PLACEHOLDER')}\"\n\t\t\t\t >\n\t\t\t`;\n\t\t});\n\t}\n\n\tonTitleEditorKeyDown(event: KeyboardEvent | UIEvent)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (this.isTitleEditEnabled())\n\t\t{\n\t\t\tif (event.key.startsWith('Enter'))\n\t\t\t{\n\t\t\t\tthis.onEditButtonClick();\n\t\t\t}\n\n\t\t\tif (event.key.startsWith('Esc'))\n\t\t\t{\n\t\t\t\tthis.disableTitleEdit();\n\t\t\t}\n\t\t}\n\t}\n\n\tonTitleEditorBlur()\n\t{\n\t\tif (this.isTitleEditEnabled())\n\t\t{\n\t\t\tthis.onEditButtonClick();\n\t\t}\n\t}\n\n\tgetActionsButtons(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('getActionsButtons', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-st-category-action-buttons\">\n\t\t\t\t\t${this.canEditTunnels ? this.getEditButton() : ''}\n\t\t\t\t\t${this.canEditTunnels ? this.getRemoveButton() : ''}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetTitleContainer(): HTMLDivElement\n\t{\n\t\treturn this.cache.remember('titleContainer', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-st-category-info-title-container\">\n\t\t\t\t\t${this.getTitle()}\n\t\t\t\t\t${this.getTitleEditor()}\n\t\t\t\t\t${this.getActionsButtons()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetDragButton(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('dragButton', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-st-category-action-drag\"\n\t\t\t\t\ttitle=\"${Loc.getMessage('CRM_ST_CATEGORY_DRAG_BUTTON')}\"\n\t\t\t\t\t>&nbsp;</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tisDrawed()\n\t{\n\t\treturn this.drawed;\n\t}\n\n\tdraw()\n\t{\n\t\tif (!this.isDrawed())\n\t\t{\n\t\t\tthis.drawed = true;\n\t\t\tDom.append(this.getContainer(), this.renderTo);\n\n\t\t\tthis.getProgressKanban().draw();\n\t\t\tthis.getSuccessKanban().draw();\n\t\t\tthis.getFailKanban().draw();\n\t\t}\n\t}\n\n\tgetKanbanColumn(columnId)\n\t{\n\t\tconst columns = [\n\t\t\t...this.getProgressKanban().getColumns(),\n\t\t\t...this.getSuccessKanban().getColumns(),\n\t\t\t...this.getFailKanban().getColumns(),\n\t\t];\n\n\t\treturn columns.find((column) => {\n\t\t\treturn columnId === column.getId() || columnId === column.getData().statusId;\n\t\t});\n\t}\n\n\tshowConfirmRemovePopup(): Promise<{confirm: boolean}>\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tvoid (new PopupWindow({\n\t\t\t\twidth: 400,\n\t\t\t\toverlay: {\n\t\t\t\t\topacity: 30,\n\t\t\t\t},\n\t\t\t\ttitleBar: Loc.getMessage('CRM_ST_REMOVE_CATEGORY_CONFIRM_POPUP_TITLE')\n\t\t\t\t\t.replace('#name#', this.getTitle().innerText),\n\t\t\t\tcontent: Loc.getMessage('CRM_ST_REMOVE_CATEGORY_CONFIRM_POPUP_DESCRIPTION'),\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew PopupWindowButton({\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ST_REMOVE_CATEGORY_CONFIRM_REMOVE_BUTTON_LABEL'),\n\t\t\t\t\t\tclassName: 'popup-window-button-decline',\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick() {\n\t\t\t\t\t\t\t\tresolve({confirm: true});\n\t\t\t\t\t\t\t\tthis.popupWindow.destroy();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\tnew PopupWindowButtonLink({\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ST_REMOVE_CATEGORY_CONFIRM_CANCEL_BUTTON_LABEL'),\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick() {\n\t\t\t\t\t\t\t\tresolve({confirm: false});\n\t\t\t\t\t\t\t\tthis.popupWindow.destroy();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t})).show();\n\t\t});\n\t}\n\n\tgetRobotsLinkIcon(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('robotsLinkIcon', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"crm-st-robots-link-icon\"> </span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tshowRobotsLinkIcon()\n\t{\n\t\tDom.insertAfter(this.getRobotsLinkIcon(), this.getRobotsLink());\n\t}\n\n\thideRobotsLinkIcon()\n\t{\n\t\tDom.remove(this.getRobotsLinkIcon());\n\t}\n\n\tadjustRobotsLinkIcon()\n\t{\n\t\tsetTimeout(() => {\n\t\t\tif (this.hasTunnels())\n\t\t\t{\n\t\t\t\tthis.showRobotsLinkIcon();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.hideRobotsLinkIcon();\n\t\t});\n\t}\n\n\tgetGeneratorLinkIcon(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('generatorLinkIcon', () => {\n\t\t\tconst onClick = () => top.open('/marketing/rc/');\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"crm-st-generator-link-icon\" onclick=\"${onClick}\">${this.generatorsCount}</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tshowGeneratorLinkIcon()\n\t{\n\t\tDom.insertAfter(this.getGeneratorLinkIcon(), this.getGeneratorLink());\n\t}\n}","import {Dom, Event, Loc, Tag, Type, Cache, Runtime, Text} from 'main.core';\nimport {PopupMenuWindow} from 'main.popup';\nimport * as d3 from 'main.d3js';\nimport isOverlap from './internal/is-overlap';\nimport makeRelativeRect from './internal/make-relative-rect';\nimport getMiddlePoint from './internal/get-middle-point';\nimport Link from '../type/link';\nimport {Category} from '../category/category';\n\n/**\n * Implements interface for works with marker\n */\nexport default class Marker extends Event.EventEmitter\n{\n\tstatic instances: Array<Marker> = [];\n\tstatic paths: Array<Array<{x: number, y: number}>> = [];\n\n\tstatic getMarkerFromPoint(point)\n\t{\n\t\treturn Marker.instances.find((marker) => {\n\t\t\treturn marker.isReceiverIntersecting(point);\n\t\t});\n\t}\n\n\tstatic emitReceiverDragOutForAll(exclude: ?Marker = null)\n\t{\n\t\tMarker.instances.forEach((marker) => {\n\t\t\tif (marker !== exclude)\n\t\t\t{\n\t\t\t\tmarker.onReceiverDragOut();\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic getAllLinks(): Set<Link>\n\t{\n\t\treturn Marker.instances.reduce((/* Set */acc, marker) => {\n\t\t\treturn [...marker.links].reduce((acc, link) => acc.add(link), acc);\n\t\t}, new Set());\n\t}\n\n\tstatic getAllStubLinks(): Set<Link>\n\t{\n\t\treturn Marker.instances.reduce((/* Set */acc, marker) => {\n\t\t\treturn [...marker.stubLinks].reduce((acc, link) => acc.add(link), acc);\n\t\t}, new Set());\n\t}\n\n\tstatic highlightLink(...targets: Link)\n\t{\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tif (!targets.includes(link))\n\t\t\t{\n\t\t\t\tif ([...targets].every(item => item.from !== link.from))\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(link.from.dispatcher, 'crm-st-fade');\n\t\t\t\t\tDom.addClass(link.from.receiver, 'crm-st-fade');\n\t\t\t\t\tDom.addClass(link.from.getTunnelButton(), 'crm-st-fade');\n\t\t\t\t}\n\n\t\t\t\tDom.addClass(link.to.dispatcher, 'crm-st-fade');\n\t\t\t\tDom.addClass(link.to.receiver, 'crm-st-fade');\n\t\t\t\tDom.addClass(link.node.node(), 'crm-st-fade');\n\t\t\t\tDom.addClass(link.arrow.select('path').node(), 'crm-st-fade');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst node = link.node.node();\n\t\t\t\tnode.parentNode.appendChild(node);\n\n\t\t\t\tconst arrowMarker = link.arrow.node();\n\t\t\t\tconst defs = arrowMarker.closest('defs');\n\n\t\t\t\tDom.insertAfter(arrowMarker, defs.firstChild);\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic unhighlightLinks()\n\t{\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tDom.removeClass(link.from.dispatcher, 'crm-st-fade');\n\t\t\tDom.removeClass(link.from.receiver, 'crm-st-fade');\n\t\t\tDom.removeClass(link.from.getTunnelButton(), 'crm-st-fade');\n\t\t\tDom.removeClass(link.to.dispatcher, 'crm-st-fade');\n\t\t\tDom.removeClass(link.to.receiver, 'crm-st-fade');\n\t\t\tDom.removeClass(link.node.node(), 'crm-st-fade');\n\t\t\tDom.removeClass(link.arrow.select('path').node(), 'crm-st-fade');\n\t\t});\n\t}\n\n\tstatic blurLinks(marker: Marker)\n\t{\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tif (link.from === marker || link.to === marker)\n\t\t\t{\n\t\t\t\tDom.addClass(link.node.node(), 'crm-st-blur-link');\n\t\t\t\tDom.addClass(link.from.getTunnelButton(), 'crm-st-blur-link');\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic unblurLinks()\n\t{\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tDom.removeClass(link.node.node(), 'crm-st-blur-link');\n\t\t\tDom.removeClass(link.from.getTunnelButton(), 'crm-st-blur-link');\n\t\t\tDom.removeClass(link.to.getTunnelButton(), 'crm-st-blur-link');\n\t\t});\n\t}\n\n\tstatic removeAllLinks()\n\t{\n\t\tMarker.instances.forEach((marker) => {\n\t\t\tconst preventSave = true;\n\t\t\tmarker.removeAllLinks(preventSave);\n\t\t});\n\n\t\tMarker.instances.forEach((marker) => {\n\t\t\tmarker.removeAllStubLinks();\n\t\t});\n\t}\n\n\tstatic restoreAllLinks()\n\t{\n\t\tconst preventSave = true;\n\n\t\tMarker.getAllLinks().forEach((link) => {\n\t\t\tlink.from.links.delete(link);\n\t\t\tlink.from.addLinkTo(link.to, preventSave);\n\t\t});\n\t}\n\n\tstatic adjustLinks()\n\t{\n\t\tMarker.getAllLinks()\n\t\t\t.forEach((link, index) => {\n\t\t\t\tconst path = link.from.getLinkPath(link.to);\n\n\t\t\t\tlink.node\n\t\t\t\t\t.style('transition', 'none');\n\t\t\t\td3.select(link.from.getTunnelButton())\n\t\t\t\t\t.style('transition', 'none');\n\n\t\t\t\tlink.from.showTunnelButton(path);\n\t\t\t\tlink.node.attr('d', d3.line()(path));\n\t\t\t\tlink.path = path;\n\n\t\t\t\tclearTimeout(Marker.adjustLinksTimeoutIds[index]);\n\t\t\t\tMarker.adjustLinksTimeoutIds[index] = setTimeout(() => {\n\t\t\t\t\tlink.node\n\t\t\t\t\t\t.style('transition', null);\n\t\t\t\t\td3.select(link.from.getTunnelButton())\n\t\t\t\t\t\t.style('transition', null);\n\t\t\t\t}, 1000);\n\t\t\t});\n\t}\n\n\tstatic adjustLinksTimeoutIds = {};\n\n\t// Links from this marker\n\tlinks: Set<Link> = new Set();\n\tstubLinks: Set<Link> = new Set();\n\tcache = new Cache.MemoryCache();\n\n\tconstructor(options: {\n\t\tdispatcher: HTMLElement,\n\t\treceiver: HTMLElement,\n\t\tpoint: HTMLElement,\n\t\tcontainer: HTMLElement,\n\t\tintermediateXPoints: Array<number>,\n\t\tname: string,\n\t\tdata?: {[key: string]: any},\n\t})\n\t{\n\t\tsuper();\n\n\t\tthis.dispatcher = options.dispatcher;\n\t\tthis.receiver = options.receiver;\n\t\tthis.point = options.point;\n\t\tthis.container = options.container;\n\t\tthis.intermediateXPoints = options.intermediateXPoints;\n\t\tthis.name = options.name;\n\t\tthis.data = options.data;\n\n\t\tconst linksRoot = this.getLinksRoot();\n\n\t\t// Add arrow marker\n\t\tif (!linksRoot.select('defs').node())\n\t\t{\n\t\t\tlinksRoot\n\t\t\t\t.append('svg:defs')\n\t\t\t\t.append('filter')\n\t\t\t\t.attr('id', 'crm-st-blur')\n\t\t\t\t.append('feGaussianBlur')\n\t\t\t\t.attr('stdDeviation', '2');\n\n\t\t\tlinksRoot\n\t\t\t\t.select('#crm-st-blur')\n\t\t\t\t.append('feColorMatrix')\n\t\t\t\t.attr('type', 'saturate')\n\t\t\t\t.attr('values', '0');\n\t\t}\n\n\t\tthis.onDispatcherMouseDown = this.onDispatcherMouseDown.bind(this);\n\t\tthis.onMarkerRootMouseUp = this.onMarkerRootMouseUp.bind(this);\n\t\tthis.onMarkerRootMouseMove = this.onMarkerRootMouseMove.bind(this);\n\n\t\td3.select(this.dispatcher).on('mousedown', this.onDispatcherMouseDown);\n\n\t\tMarker.instances.push(this);\n\t}\n\n\tdisable()\n\t{\n\t\tthis.disabled = true;\n\t}\n\n\tenable()\n\t{\n\t\tthis.disabled = false;\n\t}\n\n\tisEnabled(): boolean\n\t{\n\t\treturn !this.disabled;\n\t}\n\n\tgetMarkerRoot(): d3.Selection\n\t{\n\t\treturn this.cache.remember('markerRoot', () => {\n\t\t\tconst markerRoot = d3\n\t\t\t\t.select(this.container)\n\t\t\t\t.select('.crm-st-svg-root');\n\n\t\t\tif (markerRoot.node())\n\t\t\t{\n\t\t\t\treturn markerRoot;\n\t\t\t}\n\n\t\t\treturn d3\n\t\t\t\t.select(this.container)\n\t\t\t\t.append('svg')\n\t\t\t\t.attr('class', 'crm-st-svg-root');\n\t\t});\n\t}\n\n\tgetMarkerRootRect(): ClientRect | DOMRect\n\t{\n\t\treturn this.getMarkerRoot().node().getBoundingClientRect();\n\t}\n\n\tgetLinksRoot(): d3.Selection\n\t{\n\t\treturn this.cache.remember('linksRoot', () => {\n\t\t\tconst linksRoot = d3\n\t\t\t\t.select(this.container)\n\t\t\t\t.select('.crm-st-svg-links-root');\n\n\t\t\tif (linksRoot.node())\n\t\t\t{\n\t\t\t\treturn linksRoot;\n\t\t\t}\n\n\t\t\treturn d3\n\t\t\t\t.select(this.container)\n\t\t\t\t.append('svg')\n\t\t\t\t.attr('class', 'crm-st-svg-links-root');\n\t\t});\n\t}\n\n\tgetMarkerLine(): d3.Selection\n\t{\n\t\treturn this.cache.remember('markerLine', () => {\n\t\t\treturn this.getMarkerRoot()\n\t\t\t\t.append('line')\n\t\t\t\t.attr('class', 'crm-st-svg-marker');\n\t\t});\n\t}\n\n\tremoveMarkerLine()\n\t{\n\t\tthis.getMarkerLine().remove();\n\t\tthis.cache.delete('markerLine');\n\t}\n\n\tgetDispatcherRect(): ClientRect | DOMRect | {middleX: number, middleY: number}\n\t{\n\t\tconst relativeRect = makeRelativeRect(\n\t\t\tthis.getMarkerRootRect(),\n\t\t\tthis.dispatcher.getBoundingClientRect(),\n\t\t);\n\n\t\treturn {\n\t\t\t...relativeRect,\n\t\t\t...getMiddlePoint(relativeRect),\n\t\t};\n\t}\n\n\tgetReceiverRect(): ClientRect | DOMRect | {middleX: number, middleY: number}\n\t{\n\t\tconst relativeRect = makeRelativeRect(\n\t\t\tthis.getMarkerRootRect(),\n\t\t\tthis.receiver.getBoundingClientRect(),\n\t\t);\n\n\t\treturn {\n\t\t\t...relativeRect,\n\t\t\t...getMiddlePoint(relativeRect),\n\t\t};\n\t}\n\n\tgetPointRect(): ClientRect | DOMRect | {middleX: number, middleY: number}\n\t{\n\t\tconst relativeRect = makeRelativeRect(\n\t\t\tthis.getMarkerRootRect(),\n\t\t\tthis.point.getBoundingClientRect(),\n\t\t);\n\n\t\treturn {\n\t\t\t...relativeRect,\n\t\t\t...getMiddlePoint(relativeRect),\n\t\t};\n\t}\n\n\tgetMarkerRootMousePosition(): {x: number, y: number}\n\t{\n\t\tconst [x, y] = d3.mouse(this.getMarkerRoot().node());\n\t\treturn {x, y};\n\t}\n\n\t/** @private */\n\tonReceiverDragOver(from, to)\n\t{\n\t\tif (!this.hovered)\n\t\t{\n\t\t\tthis.hovered = true;\n\t\t\tthis.emit('Marker:receiver:dragOver', {from, to});\n\t\t}\n\t}\n\n\t/** @private */\n\tonReceiverDragOut()\n\t{\n\t\tif (this.hovered)\n\t\t{\n\t\t\tthis.hovered = false;\n\t\t\tthis.emit('Marker:receiver:dragOut');\n\t\t}\n\t}\n\n\t/** @private */\n\tonDispatcherMouseDown()\n\t{\n\t\tconst {middleX, middleY} = this.getDispatcherRect();\n\n\t\tthis.getMarkerLine()\n\t\t\t.attr('x1', middleX)\n\t\t\t.attr('y1', middleY)\n\t\t\t.attr('x2', middleX)\n\t\t\t.attr('y2', middleY);\n\n\t\tthis.getMarkerRoot()\n\t\t\t.style('z-index', '222')\n\t\t\t.on('mousemove', this.onMarkerRootMouseMove)\n\t\t\t.on('mouseup', this.onMarkerRootMouseUp);\n\n\t\tthis.emit('Marker:dragStart');\n\t}\n\n\t/** @private */\n\tonMarkerRootMouseMove()\n\t{\n\t\tconst {x, y} = this.getMarkerRootMousePosition();\n\n\t\tthis.getMarkerLine()\n\t\t\t.attr('x2', x)\n\t\t\t.attr('y2', y);\n\n\t\tthis.emit('Marker:drag');\n\n\t\tconst destinationMarker = this.getDestinationMarker();\n\n\t\tif (destinationMarker && destinationMarker.isEnabled())\n\t\t{\n\t\t\tif (destinationMarker !== this)\n\t\t\t{\n\t\t\t\tdestinationMarker.onReceiverDragOver(this, destinationMarker);\n\t\t\t}\n\t\t}\n\n\t\tMarker.emitReceiverDragOutForAll(destinationMarker);\n\t}\n\n\t/** @private */\n\tonMarkerRootMouseUp()\n\t{\n\t\tthis.getMarkerRoot()\n\t\t\t.on('mousemove', null)\n\t\t\t.on('mouseup', null)\n\t\t\t.style('z-index', null);\n\n\t\tthis.removeMarkerLine();\n\n\t\t// @todo refactoring\n\t\tMarker.instances.forEach(marker => marker.onReceiverDragOut());\n\n\t\tconst destinationMarker = this.getDestinationMarker();\n\t\tconst event = new Event.BaseEvent({\n\t\t\tdata: {from: this, to: destinationMarker}\n\t\t});\n\t\tthis.emit('Marker:dragEnd', event);\n\n\t\tif (destinationMarker && destinationMarker.isEnabled())\n\t\t{\n\t\t\tif (destinationMarker && !event.isDefaultPrevented())\n\t\t\t{\n\t\t\t\tif (!this.data.column.data.canEditTunnels)\n\t\t\t\t{\n\t\t\t\t\tthis.emit('Marker:error', {\n\t\t\t\t\t\tmessage: Loc.getMessage('CRM_ST_TUNNEL_EDIT_ACCESS_DENIED'),\n\t\t\t\t\t});\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.addLinkTo(destinationMarker);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tgetTunnelMenu(): PopupMenuWindow\n\t{\n\t\treturn this.cache.remember('tunnelMenu', () => {\n\t\t\treturn new PopupMenuWindow({\n\t\t\t\tbindElement: this.getTunnelButton(),\n\t\t\t\titems: this.getTunnelMenuItems([...this.links][0]),\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.deactivateTunnelButton(),\n\t\t\t\t\tonPopupShow: () => this.activateTunnelButton(),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetTunnelMenuItems(link): Array<{text: string, onclick: () => void}>\n\t{\n\t\tconst self = this;\n\n\t\treturn [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_ST_SETTINGS'),\n\t\t\t\tonclick() {\n\t\t\t\t\tself.editLink(link);\n\t\t\t\t\tthis.close();\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_ST_REMOVE'),\n\t\t\t\tonclick() {\n\t\t\t\t\tself.removeLink(link);\n\t\t\t\t\tconst parentMenu = this.getParentMenuWindow();\n\n\t\t\t\t\tif (parentMenu)\n\t\t\t\t\t{\n\t\t\t\t\t\tparentMenu\n\t\t\t\t\t\t\t.removeMenuItem(this.getParentMenuItem().id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t]\n\t}\n\n\teditLink(link: Link)\n\t{\n\t\tthis.emit('Marker:editLink', {link});\n\t}\n\n\taddLinkTo(destination: Marker, preventSave = false)\n\t{\n\t\tsetTimeout(() => {\n\t\t\tif (![...this.links].some(link => link.to === destination))\n\t\t\t{\n\t\t\t\tconst linksRoot = this.getLinksRoot();\n\t\t\t\tconst path = this.getLinkPath(destination);\n\n\t\t\t\tconst line = d3.line();\n\n\t\t\t\tconst fromId = this.data.column.getId().replace(':', '-');\n\t\t\t\tconst toId = destination.data.column.getId().replace(':', '-');\n\n\t\t\t\tconst arrowId = `${fromId}-${toId}`;\n\n\t\t\t\tconst arrow = linksRoot\n\t\t\t\t\t.select('defs')\n\t\t\t\t\t.append('svg:marker')\n\t\t\t\t\t.attr('id', arrowId)\n\t\t\t\t\t.attr('refX', 8)\n\t\t\t\t\t.attr('refY', 6)\n\t\t\t\t\t.attr('markerWidth', 30)\n\t\t\t\t\t.attr('markerHeight', 30)\n\t\t\t\t\t.attr('markerUnits','userSpaceOnUse')\n\t\t\t\t\t.attr('orient', 'auto')\n\t\t\t\t\t.append('path')\n\t\t\t\t\t.attr('d', 'M 0 0 12 6 0 12 3 6')\n\t\t\t\t\t.attr('class', 'crm-st-svg-link-arrow')\n\t\t\t\t\t.select(function() {\n\t\t\t\t\t\treturn this.parentNode;\n\t\t\t\t\t});\n\n\t\t\t\tconst linkNode = linksRoot\n\t\t\t\t\t.append('path')\n\t\t\t\t\t.attr('class', 'crm-st-svg-link')\n\t\t\t\t\t.attr('marker-end', `url(#${arrowId})`)\n\t\t\t\t\t.attr('d', line(path));\n\n\t\t\t\tthis.showTunnelButton(path);\n\n\t\t\t\tconst link = {\n\t\t\t\t\tfrom: this,\n\t\t\t\t\tto: destination,\n\t\t\t\t\tnode: linkNode,\n\t\t\t\t\tarrow,\n\t\t\t\t\tpath,\n\t\t\t\t};\n\n\t\t\t\tthis.emit('Marker:linkFrom', {link, preventSave});\n\t\t\t\tdestination.emit('Marker:linkTo', {link, preventSave});\n\n\t\t\t\tthis.links.add(link);\n\n\t\t\t\tconst menu = this.getTunnelsListMenu();\n\t\t\t\tconst id = menu.getMenuItems().length;\n\n\t\t\t\tmenu.addMenuItem({\n\t\t\t\t\tid: `#${id}`,\n\t\t\t\t\ttext: destination.name,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonMouseEnter() {\n\t\t\t\t\t\t\tMarker.highlightLink(link);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonMouseLeave() {\n\t\t\t\t\t\t\tMarker.unhighlightLinks();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\titems: this.getTunnelMenuItems(link),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.links.size > 1)\n\t\t\t{\n\t\t\t\tthis.setTunnelsCounterValue(this.links.size);\n\t\t\t}\n\t\t});\n\t}\n\n\taddStubLinkTo(destination: Marker)\n\t{\n\t\tsetTimeout(() => {\n\t\t\tif (![...this.stubLinks].some(link => link.to === destination))\n\t\t\t{\n\t\t\t\tconst linksRoot = this.getLinksRoot();\n\t\t\t\tconst path = this.getLinkPath(destination);\n\n\t\t\t\tconst line = d3.line();\n\n\t\t\t\tconst fromId = this.data.column.getId().replace(':', '-');\n\t\t\t\tconst toId = destination.data.column.getId().replace(':', '-');\n\n\t\t\t\tconst arrowId = `${fromId}-${toId}`;\n\n\t\t\t\tconst arrow = linksRoot\n\t\t\t\t\t.select('defs')\n\t\t\t\t\t.append('svg:marker')\n\t\t\t\t\t.attr('id', arrowId)\n\t\t\t\t\t.attr('refX', 8)\n\t\t\t\t\t.attr('refY', 6)\n\t\t\t\t\t.attr('markerWidth', 30)\n\t\t\t\t\t.attr('markerHeight', 30)\n\t\t\t\t\t.attr('markerUnits','userSpaceOnUse')\n\t\t\t\t\t.attr('orient', 'auto')\n\t\t\t\t\t.append('path')\n\t\t\t\t\t.attr('d', 'M 0 0 12 6 0 12 3 6')\n\t\t\t\t\t.attr('class', 'crm-st-svg-link-arrow crm-st-svg-link-arrow-stub')\n\t\t\t\t\t.select(function() {\n\t\t\t\t\t\treturn this.parentNode;\n\t\t\t\t\t});\n\n\t\t\t\tconst linkNode = linksRoot\n\t\t\t\t\t.append('path')\n\t\t\t\t\t.attr('class', 'crm-st-svg-link crm-st-svg-link-stub')\n\t\t\t\t\t.attr('marker-end', `url(#${arrowId})`)\n\t\t\t\t\t.attr('d', line(path));\n\n\t\t\t\tthis.showTunnelStubButton(path);\n\n\t\t\t\tconst link = {\n\t\t\t\t\tfrom: this,\n\t\t\t\t\tto: destination,\n\t\t\t\t\tnode: linkNode,\n\t\t\t\t\tarrow,\n\t\t\t\t\tpath,\n\t\t\t\t};\n\n\t\t\t\tthis.emit('Marker:stubLinkFrom', {link, preventSave: true});\n\t\t\t\tdestination.emit('Marker:stubLinkTo', {link, preventSave: true});\n\n\t\t\t\tthis.stubLinks.add(link);\n\t\t\t}\n\t\t});\n\t}\n\n\tupdateLink(link: Link, newTo: Marker, preventSave = false)\n\t{\n\t\tconst path = this.getLinkPath(newTo);\n\t\tconst line = d3.line();\n\t\tconst oldTo = link.to;\n\n\t\tlink.node\n\t\t\t.attr('d', line(path));\n\n\t\tlink.path = path;\n\t\tlink.to = newTo;\n\n\t\tthis.emit('Marker:linkFrom', {link, preventSave});\n\t\tnewTo.emit('Marker:linkTo', {link, preventSave});\n\n\t\tif (!oldTo.isLinked())\n\t\t{\n\t\t\toldTo.emit('Marker:unlink');\n\t\t}\n\t}\n\n\tremoveLink(link: Link, preventSave = false)\n\t{\n\t\t// @todo refactoring\n\n\t\tlink.hidden = true;\n\n\t\tif (!preventSave)\n\t\t{\n\t\t\tthis.links.delete(link);\n\t\t}\n\n\t\tlink.node.remove();\n\t\tlink.arrow.remove();\n\n\t\tif (!this.isLinkedFrom())\n\t\t{\n\t\t\tDom.remove(link.from.getTunnelButton());\n\t\t\tthis.getTunnelMenu().destroy();\n\t\t\tthis.deactivateTunnelButton();\n\t\t\tthis.cache.delete('tunnelMenu');\n\t\t}\n\n\t\tthis.setTunnelsCounterValue(this.links.size);\n\n\t\tconst visibleLinks = [...this.links].filter(item => !item.hidden);\n\n\t\tif (visibleLinks.length <= 1)\n\t\t{\n\t\t\tif (this.getTunnelsListMenu().getPopupWindow().isShown())\n\t\t\t{\n\t\t\t\tthis.getTunnelMenu().destroy();\n\t\t\t\tthis.cache.delete('tunnelMenu');\n\n\t\t\t\tthis.getTunnelMenu().show();\n\t\t\t}\n\n\t\t\tthis.getTunnelsListMenu().destroy();\n\t\t\tthis.deactivateTunnelButton();\n\t\t\tthis.cache.delete('tunnelsListMenu');\n\t\t}\n\n\t\tlink.from.emit('Marker:removeLinkFrom', {link, preventSave});\n\n\t\tif (!link.from.isLinked())\n\t\t{\n\t\t\tlink.from.emit('Marker:unlink', {preventSave});\n\t\t}\n\n\t\tlink.to.emit('Marker:removeTo', {link, preventSave});\n\n\t\tif (!link.to.isLinked())\n\t\t{\n\t\t\tlink.to.emit('Marker:unlink', {preventSave});\n\t\t}\n\t}\n\n\tremoveAllLinks(preventSave = false)\n\t{\n\t\tthis.links.forEach(link => this.removeLink(link, preventSave));\n\t}\n\n\tremoveStubLink(link: Link)\n\t{\n\t\tthis.stubLinks.delete(link);\n\n\t\tlink.node.remove();\n\t\tlink.arrow.remove();\n\n\t\tif (!this.isLinkedStub())\n\t\t{\n\t\t\tDom.remove(link.from.getStubTunnelButton());\n\t\t}\n\n\t\tlink.from.emit('Marker:removeStubLink', {link});\n\t\tlink.from.emit('Marker:removeStubLinkFrom', {link});\n\n\t\tif (!link.from.isLinkedStub())\n\t\t{\n\t\t\tlink.from.emit('Marker:unlinkStub');\n\t\t}\n\n\t\tlink.to.emit('Marker:removeStubTo', {link});\n\n\t\tif (!link.to.isLinkedStub())\n\t\t{\n\t\t\tlink.to.emit('Marker:unlinkStub');\n\t\t}\n\t}\n\n\tremoveAllStubLinks()\n\t{\n\t\tthis.stubLinks.forEach(link => this.removeStubLink(link));\n\t}\n\n\tisLinked(): boolean\n\t{\n\t\treturn [...Marker.getAllLinks()]\n\t\t\t.some((item) => {\n\t\t\t\treturn !item.hidden && (item.from === this || item.to === this)\n\t\t\t});\n\t}\n\n\tisLinkedFrom(): boolean\n\t{\n\t\treturn [...Marker.getAllLinks()]\n\t\t\t.some(item => !item.hidden && item.from === this);\n\t}\n\n\tisLinkedTo(): boolean\n\t{\n\t\treturn [...Marker.getAllLinks()]\n\t\t\t.some(item => !item.hidden && item.to === this);\n\t}\n\n\tisLinkedStub(): boolean\n\t{\n\t\treturn [...Marker.getAllLinks()]\n\t\t\t.some(item => !item.hidden && (item.from === this || item.to === this));\n\t}\n\n\tshowTunnelButton(path)\n\t{\n\t\tconst button = this.getTunnelButton();\n\t\tconst category = this.getCategory();\n\t\tconst left = path[0][0];\n\n\t\tTag.style(button)`\n\t\t\tbottom: 0px;\n\t\t\tleft: ${left}px;\n\t\t\ttransform: translate3d(-50%, 50%, 0);\n\t\t`;\n\n\t\tif (!category.contains(button))\n\t\t{\n\t\t\tDom.append(button, category);\n\t\t}\n\t}\n\n\tgetStubTunnelButton()\n\t{\n\t\treturn this.cache.remember('tunnelStubButton', () => {\n\t\t\tconst button = Runtime.clone(this.getTunnelButton());\n\t\t\tDom.addClass(button, 'crm-st-tunnel-button-stub');\n\t\t\treturn button;\n\t\t});\n\t}\n\n\tshowTunnelStubButton(path)\n\t{\n\t\tconst button = this.getStubTunnelButton();\n\t\tconst category = this.getCategory();\n\t\tconst left = path[0][0];\n\n\t\tTag.style(button)`\n\t\t\tbottom: 0px;\n\t\t\tleft: ${left}px;\n\t\t\ttransform: translate3d(-50%, 50%, 0);\n\t\t`;\n\n\t\tif (!category.contains(button))\n\t\t{\n\t\t\tDom.append(button, category);\n\t\t}\n\t}\n\n\tgetTunnelButton()\n\t{\n\t\tconst canEdit = this.data.column.data.canEditTunnels;\n\t\treturn this.cache.remember('tunnelButton', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"crm-st-tunnel-button\" \n\t\t\t\t\t onmouseenter=\"${this.onTunnelButtonMouseEnter.bind(this)}\"\n\t\t\t\t\t onmouseleave=\"${this.onTunnelButtonMouseLeave.bind(this)}\"\n\t\t\t\t\t onclick=\"${this.onTunnelButtonClick.bind(this)}\"\n\t\t\t\t\t title=\"${Loc.getMessage('CRM_ST_TUNNEL_BUTTON_TITLE')}\"\n\t\t\t\t\t style=\"${!canEdit ? 'pointer-events: none;' : ''}\"\n\t\t\t\t>${Loc.getMessage(\"CRM_ST_TUNNEL_BUTTON_LABEL\")}</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t/** @private */\n\tonTunnelButtonMouseEnter()\n\t{\n\t\tMarker.highlightLink(...this.links);\n\t}\n\n\t// noinspection JSMethodCanBeStatic\n\t/** @private */\n\tonTunnelButtonMouseLeave()\n\t{\n\t\tMarker.unhighlightLinks();\n\t}\n\n\t/** @private */\n\tonTunnelButtonClick()\n\t{\n\t\tif (this.links.size > 1)\n\t\t{\n\t\t\tif (this.isTunnelButtonActive())\n\t\t\t{\n\t\t\t\tthis.getTunnelsListMenu().close();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getTunnelsListMenu().show();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getTunnelMenu().show();\n\t\t}\n\t}\n\n\tgetTunnelsListMenu(): PopupMenuWindow\n\t{\n\t\treturn this.cache.remember('tunnelsListMenu', () => {\n\t\t\treturn new PopupMenuWindow({\n\t\t\t\tbindElement: this.getTunnelButton(),\n\t\t\t\titems: [],\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tmenuShowDelay: 0,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => this.deactivateTunnelButton(),\n\t\t\t\t\tonPopupShow: () => this.activateTunnelButton(),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tactivateTunnelButton()\n\t{\n\t\tDom.addClass(this.getTunnelButton(), 'crm-st-tunnel-button-active');\n\t}\n\n\tdeactivateTunnelButton()\n\t{\n\t\tDom.removeClass(this.getTunnelButton(), 'crm-st-tunnel-button-active');\n\t}\n\n\tisTunnelButtonActive(): boolean\n\t{\n\t\treturn Dom.hasClass(this.getTunnelButton(), 'crm-st-tunnel-button-active');\n\t}\n\n\tgetTunnelsCounter(): HTMLSpanElement\n\t{\n\t\treturn this.cache.remember('tunnelsCounter', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"crm-st-tunnel-button-counter\">0</span>\n\t\t\t`;\n\t\t})\n\t}\n\n\tsetTunnelsCounterValue(value: number)\n\t{\n\t\tconst tunnelButton = this.getTunnelButton();\n\t\tconst tunnelsCounter = this.getTunnelsCounter();\n\n\t\tif (value > 1)\n\t\t{\n\t\t\tif (!tunnelButton.contains(tunnelsCounter))\n\t\t\t{\n\t\t\t\tDom.append(tunnelsCounter, tunnelButton);\n\t\t\t}\n\n\t\t\ttunnelsCounter.innerText = value;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttunnelsCounter.innerText = 0;\n\t\t\tDom.remove(tunnelsCounter);\n\t\t}\n\t}\n\n\tgetCategory(): Category\n\t{\n\t\treturn this.receiver.closest('.crm-st-category');\n\t}\n\n\tgetIntermediateXPoints(): Array<number>\n\t{\n\t\tif (Type.isArray(this.intermediateXPoints))\n\t\t{\n\t\t\tconst markerRootRect = this.getMarkerRootRect();\n\t\t\treturn this.intermediateXPoints\n\t\t\t\t.map(value => value - markerRootRect.left);\n\t\t}\n\n\t\tif (Type.isFunction(this.intermediateXPoints))\n\t\t{\n\t\t\tconst markerRootRect = this.getMarkerRootRect();\n\t\t\treturn this.intermediateXPoints()\n\t\t\t\t.map(value => value - markerRootRect.left);\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tgetNearestIntermediateXPoint(x: number): number\n\t{\n\t\treturn this.getIntermediateXPoints().reduce((prev, curr) => {\n\t\t\treturn (Math.abs(curr - x) < Math.abs(prev - x) ? curr: prev);\n\t\t});\n\t}\n\n\tgetLinkPath(target: Marker): Array<[number, number]>\n\t{\n\t\tconst targetPosition = target.getPointRect();\n\t\tconst currentPosition = this.getDispatcherRect();\n\n\t\tconst baseOffset = 80;\n\t\tconst markerMargin = 10;\n\t\tconst path = [];\n\n\t\tpath.push([\n\t\t\tcurrentPosition.middleX,\n\t\t\tcurrentPosition.middleY,\n\t\t]);\n\n\t\tpath.push([\n\t\t\tcurrentPosition.middleX,\n\t\t\tcurrentPosition.middleY + baseOffset,\n\t\t]);\n\n\t\tif (currentPosition.middleY !== targetPosition.middleY)\n\t\t{\n\t\t\tconst intermediateX = this.getNearestIntermediateXPoint(targetPosition.middleX);\n\n\t\t\tpath.push([\n\t\t\t\tintermediateX,\n\t\t\t\tcurrentPosition.middleY + baseOffset,\n\t\t\t]);\n\n\t\t\tpath.push([\n\t\t\t\tintermediateX,\n\t\t\t\ttargetPosition.middleY + (baseOffset / 3) - (markerMargin / 3),\n\t\t\t]);\n\n\t\t\tpath.push([\n\t\t\t\ttargetPosition.middleX,\n\t\t\t\ttargetPosition.middleY + (baseOffset / 3) - (markerMargin / 3),\n\t\t\t]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpath.push([\n\t\t\t\ttargetPosition.middleX,\n\t\t\t\ttargetPosition.middleY + baseOffset,\n\t\t\t]);\n\t\t}\n\n\t\tpath.push([\n\t\t\ttargetPosition.middleX,\n\t\t\ttargetPosition.middleY + markerMargin,\n\t\t]);\n\n\t\tconst lineOffset = 4;\n\n\t\treturn [...Marker.getAllLinks()].reduce((acc, link) => {\n\t\t\tconst {from, path: currentPath} = link;\n\n\t\t\tif (from !== this)\n\t\t\t{\n\t\t\t\t/**\n\t\t\t\t * Horizon lines\n\t\t\t\t * 1x -> 2x\n\t\t\t\t * 3x -> 4x\n\t\t\t\t */\n\n\t\t\t\tif (acc[1][1] === currentPath[1][1])\n\t\t\t\t{\n\t\t\t\t\tif (isOverlap([acc[1][0], acc[2][0]], [currentPath[1][0], currentPath[2][0]]))\n\t\t\t\t\t{\n\t\t\t\t\t\tacc[1][1] += lineOffset;\n\t\t\t\t\t\tacc[2][1] += lineOffset;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (currentPath.length === 6)\n\t\t\t\t{\n\t\t\t\t\tif (acc[1][1] === currentPath[3][1])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (isOverlap([acc[1][0], acc[2][0]], [currentPath[3][0], currentPath[4][0]]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tacc[1][1] += lineOffset;\n\t\t\t\t\t\t\tacc[2][1] += lineOffset;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (acc.length === 6)\n\t\t\t\t{\n\t\t\t\t\tif (acc[3][1] === currentPath[1][1])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (isOverlap([acc[3][0], acc[4][0]], [currentPath[1][0], currentPath[2][0]]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tacc[3][1] += lineOffset;\n\t\t\t\t\t\t\tacc[4][1] += lineOffset;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (currentPath.length === 6)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (acc[3][1] === currentPath[3][1])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (isOverlap([acc[3][0], acc[4][0]], [currentPath[3][0], currentPath[4][0]]))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tacc[3][1] += lineOffset;\n\t\t\t\t\t\t\t\tacc[4][1] += lineOffset;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * Vertical line\n\t\t\t\t * 2y -> 3y\n\t\t\t\t */\n\n\t\t\t\tif (acc.length === 6)\n\t\t\t\t{\n\t\t\t\t\tif (acc[2][0] === currentPath[2][0])\n\t\t\t\t\t{\n\t\t\t\t\t\tif (isOverlap([acc[2][1], acc[3][1]], [currentPath[2][1], currentPath[3][1]]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tacc[2][0] += lineOffset;\n\t\t\t\t\t\t\tacc[3][0] += lineOffset;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn acc;\n\t\t}, [...path]);\n\t}\n\n\tgetDestinationMarker(): ?Marker\n\t{\n\t\tconst mousePosition = this.getMarkerRootMousePosition();\n\t\tconst destinationMarker = Marker.getMarkerFromPoint(mousePosition);\n\n\t\tif (destinationMarker && destinationMarker !== this)\n\t\t{\n\t\t\treturn destinationMarker;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tisReceiverIntersecting(point): boolean\n\t{\n\t\tconst receiverRect = this.getReceiverRect();\n\t\tconst heightOffset = 10;\n\n\t\treturn (\n\t\t\t(point.x > receiverRect.left && point.x < receiverRect.right)\n\t\t\t&& (point.y > receiverRect.top && point.y < (receiverRect.bottom + heightOffset))\n\t\t);\n\t}\n\n\tblurLinks()\n\t{\n\t\tMarker.blurLinks(this);\n\t}\n\n\tunblurLinks()\n\t{\n\t\tMarker.unblurLinks();\n\t}\n\n\tgetData(): {[key: string]: any}\n\t{\n\t\treturn this.data;\n\t}\n}","import {Dom, Type, Tag, Event, Loc} from 'main.core';\nimport {Kanban} from 'main.kanban';\nimport createStub from './internal/create-stub';\nimport Marker from '../marker/marker';\n\nexport default class Column extends Kanban.Column\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\n\t\tthis.currentName = this.getName();\n\n\t\tthis.marker = new Marker({\n\t\t\tdispatcher: this.getDot(),\n\t\t\treceiver: this.getHeader(),\n\t\t\tpoint: this.getDot(),\n\t\t\tcontainer: this.getData().appContainer,\n\t\t\tintermediateXPoints: () => this.getIntermediateXPoints(),\n\t\t\tname: `${this.getData().categoryName} (${this.getName()})`,\n\t\t\tdata: {\n\t\t\t\tcolumn: this,\n\t\t\t}\n\t\t});\n\n\t\tthis.marker\n\t\t\t.subscribe('Marker:dragStart', this.onMarkerDragStart.bind(this))\n\t\t\t.subscribe('Marker:receiver:dragOver', this.onMarkerDragOver.bind(this))\n\t\t\t.subscribe('Marker:receiver:dragOut', this.onMarkerDragOut.bind(this))\n\t\t\t.subscribe('Marker:dragEnd', this.onMarkerDragEnd.bind(this))\n\t\t\t.subscribe('Marker:linkFrom', this.onMarkerLinkFrom.bind(this))\n\t\t\t.subscribe('Marker:stubLinkFrom', this.onMarkerStubLinkFrom.bind(this))\n\t\t\t.subscribe('Marker:linkTo', this.onMarkerLinkTo.bind(this))\n\t\t\t.subscribe('Marker:stubLinkTo', this.onMarkerStubLinkTo.bind(this))\n\t\t\t.subscribe('Marker:removeLinkFrom', this.onRemoveLinkFrom.bind(this))\n\t\t\t.subscribe('Marker:editLink', this.onEditLink.bind(this))\n\t\t\t.subscribe('Marker:unlink', this.onMarkerUnlink.bind(this))\n\t\t\t.subscribe('Marker:unlinkStub', this.onMarkerUnlinkStub.bind(this))\n\t\t\t.subscribe('Marker:error', this.onMarkerError.bind(this));\n\n\n\t\tthis.onTransitionStart = this.onTransitionStart.bind(this);\n\t\tthis.onTransitionEnd = this.onTransitionEnd.bind(this);\n\t}\n\n\tisAllowedTransitionProperty(propertyName)\n\t{\n\t\treturn [\n\t\t\t'width',\n\t\t\t'min-width',\n\t\t\t'max-width',\n\t\t\t'transform',\n\t\t].includes(propertyName);\n\t}\n\n\tonTransitionStart(event)\n\t{\n\t\tif (event.srcElement === this.getContainer()\n\t\t\t&& this.isAllowedTransitionProperty(event.propertyName)\n\t\t)\n\t\t{\n\t\t\tclearInterval(this.intervalId);\n\t\t\tthis.intervalId = setInterval(Marker.adjustLinks, 16);\n\t\t}\n\t}\n\n\tonTransitionEnd(event)\n\t{\n\t\tif (event.srcElement === this.getContainer()\n\t\t\t&& this.isAllowedTransitionProperty(event.propertyName)\n\t\t)\n\t\t{\n\t\t\tclearInterval(this.intervalId);\n\t\t\tthis.intervalId = null;\n\t\t}\n\t}\n\n\tsetOptions(options: { name?: string; color?: string; data?: { [p: string]: any }; total?: number })\n\t{\n\t\tsuper.setOptions(options);\n\n\t\tif (Type.isFunction(options.data.onLink))\n\t\t{\n\t\t\tthis.onLinkHandler = options.data.onLink;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onRemoveLinkFrom))\n\t\t{\n\t\t\tthis.onRemoveLinkFromHandler = options.data.onRemoveLinkFrom;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onEditLink))\n\t\t{\n\t\t\tthis.onEditLinkhandler = options.data.onEditLink;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onNameChange))\n\t\t{\n\t\t\tthis.onNameChangeHandler = options.data.onNameChange;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onColorChange))\n\t\t{\n\t\t\tthis.onColorChangeHandler = options.data.onColorChange;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onAddColumn))\n\t\t{\n\t\t\tthis.onAddColumnHandler = options.data.onAddColumn;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onRemove))\n\t\t{\n\t\t\tthis.onRemoveHandler = options.data.onRemove;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onChange))\n\t\t{\n\t\t\tthis.onChangeHandler = options.data.onChange;\n\t\t}\n\n\t\tif (Type.isFunction(options.data.onError))\n\t\t{\n\t\t\tthis.onErrorHandler = options.data.onError;\n\t\t}\n\n\t\tif (this.marker)\n\t\t{\n\t\t\tthis.marker.container = this.getData().appContainer;\n\t\t\tthis.marker.cache.clear();\n\t\t}\n\t}\n\n\tonMarkerError(event)\n\t{\n\t\tthis.onErrorHandler(event.data);\n\t}\n\n\tonEditLink(event)\n\t{\n\t\tthis.onEditLinkhandler(event.data);\n\t}\n\n\tonMarkerLinkFrom(event)\n\t{\n\t\tthis.onLinkHandler(event.data);\n\t\tthis.activateDot();\n\t}\n\n\tonMarkerStubLinkFrom()\n\t{\n\t\tthis.activateStubDot();\n\t}\n\n\tonMarkerStubLinkTo()\n\t{\n\t\tthis.activateStubDot();\n\t}\n\n\tonRemoveLinkFrom(event)\n\t{\n\t\tthis.onRemoveLinkFromHandler(event.data);\n\t}\n\n\tonMarkerLinkTo()\n\t{\n\t\tthis.activateDot();\n\t}\n\n\tgetIntermediateXPoints()\n\t{\n\t\tconst {\n\t\t\tprogressStagesGroup,\n\t\t\tsuccessStagesGroup,\n\t\t\tfailStagesGroup,\n\t\t} = this.getData().stagesGroups;\n\n\t\tconst progressRect = progressStagesGroup.getBoundingClientRect();\n\t\tconst successRect = successStagesGroup.getBoundingClientRect();\n\t\tconst failRect = failStagesGroup.getBoundingClientRect();\n\n\t\tconst offset = 15;\n\n\t\treturn [\n\t\t\tprogressRect.left + offset,\n\t\t\tsuccessRect.left - offset,\n\t\t\tsuccessRect.left + offset,\n\t\t\tsuccessRect.right - offset,\n\t\t\tsuccessRect.right + offset,\n\t\t\tfailRect.right - (offset / 2),\n\t\t];\n\t}\n\n\tonMarkerDragStart()\n\t{\n\t\tthis.activateDot();\n\t}\n\n\tonMarkerDragOver(event: Event.BaseEvent)\n\t{\n\t\tconst dataFrom = event.data.from.data.column.getData();\n\t\tconst dataTo = event.data.to.data.column.getData();\n\n\t\tif (dataFrom.category.id === dataTo.category.id)\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t\tthis.disallowDot();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.allowDot();\n\t\tthis.highlightDot();\n\t}\n\n\tonMarkerDragOut()\n\t{\n\t\tthis.allowDot();\n\t\tthis.unhighlightDot();\n\t}\n\n\tonMarkerDragEnd(event: Event.BaseEvent)\n\t{\n\t\tif (!this.marker.isLinked())\n\t\t{\n\t\t\tthis.deactivateDot();\n\t\t}\n\n\t\tif (event.data.from && event.data.to)\n\t\t{\n\t\t\tconst dataFrom = event.data.from.data.column.getData();\n\t\t\tconst dataTo = event.data.to.data.column.getData();\n\n\t\t\tif (dataFrom.category.id === dataTo.category.id)\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t}\n\t}\n\n\tonMarkerUnlink()\n\t{\n\t\tthis.deactivateDot();\n\t\tthis.deactivateStubDot();\n\t}\n\n\tonMarkerUnlinkStub()\n\t{\n\t\tthis.deactivateStubDot();\n\t}\n\n\tactivateDot()\n\t{\n\t\tDom.addClass(this.getDot(), 'crm-st-kanban-column-dot-active');\n\t}\n\n\tdeactivateDot()\n\t{\n\t\tDom.removeClass(this.getDot(), 'crm-st-kanban-column-dot-active');\n\t}\n\n\tactivateStubDot()\n\t{\n\t\tDom.addClass(this.getDot(), 'crm-st-kanban-column-dot-active-stub');\n\t}\n\n\tdeactivateStubDot()\n\t{\n\t\tDom.removeClass(this.getDot(), 'crm-st-kanban-column-dot-active-stub');\n\t}\n\n\thighlightDot()\n\t{\n\t\tDom.addClass(this.getDot(), 'crm-st-kanban-column-dot-highlight');\n\t}\n\n\tunhighlightDot()\n\t{\n\t\tDom.removeClass(this.getDot(), 'crm-st-kanban-column-dot-highlight');\n\t}\n\n\tallowDot()\n\t{\n\t\tDom.removeClass(this.getDot(), 'crm-st-kanban-column-dot-disallow');\n\t}\n\n\tdisallowDot()\n\t{\n\t\tDom.addClass(this.getDot(), 'crm-st-kanban-column-dot-disallow');\n\t}\n\n\tgetBody()\n\t{\n\t\treturn createStub();\n\t}\n\n\tgetDot()\n\t{\n\t\tif (!Type.isDomNode(this.dot))\n\t\t{\n\t\t\tconst title = Loc.getMessage('CRM_ST_DOT_TITLE');\n\t\t\tthis.dot = Tag.render`<div class=\"crm-st-kanban-column-dot\" title=\"${title}\">\n\t\t\t\t<span class=\"crm-st-kanban-column-dot-disallow-icon\"> </span>\n\t\t\t\t<span class=\"crm-st-kanban-column-dot-pulse\"> </span>\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn this.dot;\n\t}\n\n\tgetHeader()\n\t{\n\t\tconst header = super.getHeader();\n\n\t\tif (!this.headerDotted)\n\t\t{\n\t\t\tthis.headerDotted = true;\n\n\t\t\tconst dot = this.getDot();\n\n\t\t\tEvent.bind(dot, 'mousedown', (event) => event.stopPropagation());\n\t\t\tEvent.bind(dot, 'mouseup', (event) => event.stopPropagation());\n\t\t\tEvent.bind(dot, 'mousemove', (event) => event.stopPropagation());\n\n\t\t\tDom.append(dot, header);\n\t\t}\n\n\t\tTag.attrs(header)`\n\t\t\ttitle: ${this.getName()};\n\t\t`;\n\n\t\treturn header;\n\t}\n\n\tgetSubTitle()\n\t{\n\t\treturn createStub();\n\t}\n\n\tgetContainer()\n\t{\n\t\tconst container = super.getContainer();\n\t\tDom.addClass(container, 'crm-st-kanban-column');\n\n\t\tEvent.bind(container, 'transitionstart', this.onTransitionStart);\n\t\tEvent.bind(container, 'transitionend', this.onTransitionEnd);\n\t\treturn container;\n\t}\n\n\tgetTotalItem()\n\t{\n\t\tthis.layout.total = createStub();\n\t\treturn this.layout.total;\n\t}\n\n\thandleTextBoxBlur(event)\n\t{\n\t\tsuper.handleTextBoxBlur(event);\n\n\t\tsetTimeout(() => {\n\t\t\tif (this.currentName !== this.getName())\n\t\t\t{\n\t\t\t\tthis.onNameChangeHandler(this);\n\t\t\t\tthis.currentName = this.getName();\n\n\t\t\t\tTag.attrs(this.getHeader())`\n\t\t\t\t\ttitle: ${this.getName()};\n\t\t\t\t`;\n\t\t\t}\n\t\t}, 500);\n\t}\n\n\tonColorSelected(color)\n\t{\n\t\tsuper.onColorSelected(color);\n\t\tthis.onColorChangeHandler(this);\n\t}\n\n\thandleAddColumnButtonClick(event)\n\t{\n\t\tsuper.handleAddColumnButtonClick(event);\n\t\tconst newColumn = this.getGrid().getNextColumnSibling(this);\n\t\tnewColumn.setOptions({\n\t\t\tcanRemove: true,\n\t\t\tcanSort: true,\n\t\t});\n\t\tthis.onAddColumnHandler(newColumn);\n\t}\n\n\thandleRemoveButtonClick(event: any)\n\t{\n\t\tthis.getConfirmDialog().setContent(Loc.getMessage('CRM_ST_CONFIRM_STAGE_REMOVE_TEXT'));\n\t\tsuper.handleRemoveButtonClick(event);\n\t}\n\n\thandleConfirmButtonClick() {\n\t\t// @todo refactoring\n\n\t\tconst event = new Event.BaseEvent({\n\t\t\tdata: {\n\t\t\t\tcolumn: this,\n\t\t\t\tonConfirm: () => {\n\t\t\t\t\tMarker.getAllLinks()\n\t\t\t\t\t\t.forEach((link) => {\n\t\t\t\t\t\t\tif (String(link.to.data.column.id) === String(this.id))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlink.from.removeLink(link);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (String(link.from.data.column.id) === String(this.id))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlink.from.removeLink(link);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\tsuper.handleConfirmButtonClick();\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tMarker.removeAllLinks();\n\t\t\t\t\t\tMarker.restoreAllLinks();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tonCancel: () => {\n\t\t\t\t\tthis.getConfirmDialog().close();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\tthis.onRemoveHandler(event);\n\t}\n\n\tswitchToEditMode()\n\t{\n\t\tsuper.switchToEditMode();\n\t}\n\n\tapplyEditMode()\n\t{\n\t\tconst title = BX.util.trim(this.getTitleTextBox().value);\n\t\tconst colorChanged = this.colorChanged;\n\t\tlet titleChanged = false;\n\t\tif (title.length > 0 && this.getName() !== title)\n\t\t{\n\t\t\ttitleChanged = true;\n\t\t}\n\n\t\tsuper.applyEditMode();\n\n\t\tif (titleChanged || colorChanged)\n\t\t{\n\t\t\tthis.onChangeHandler(this);\n\t\t}\n\t}\n\n\tonColumnDrag(x, y)\n\t{\n\t\tsuper.onColumnDrag(x, y);\n\t\tMarker.adjustLinks();\n\t}\n\n\tresetRectArea()\n\t{\n\t\tsuper.resetRectArea();\n\n\t\tclearTimeout(this.resetRectAreaTimeoutId);\n\t\tthis.resetRectAreaTimeoutId = setTimeout(() => {\n\t\t\tMarker.adjustLinks();\n\t\t}, 200);\n\t}\n}","import {ajax} from 'main.core';\nimport type RequestResponse from './type/request-response';\nimport type CreateCategoryOptions from './type/create-category-options';\nimport type GetCategoryOptions from './type/get-category-options';\nimport type UpdateCategoryOptions from './type/update-category-options';\nimport type RemoveCategoryOptions from './type/remove-category-options';\nimport type CreateRobotOptions from './type/create-robot-options';\nimport type RemoveRobotOptions from './type/remove-robot-options';\nimport type RemoveStageOptions from './type/remove-stage-options';\nimport type UpdateStageOptions from './type/update-stage-options';\nimport type AddStageOptions from './type/update-stage-options';\n\nexport default class Backend\n{\n\tstatic component: string = 'bitrix:crm.sales.tunnels';\n\n\tstatic request({action, data, analyticsLabel}: RequestOptions): Promise<RequestResponse>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runComponentAction(\n\t\t\t\tBackend.component,\n\t\t\t\taction,\n\t\t\t\t{\n\t\t\t\t\tmode: 'ajax',\n\t\t\t\t\tdata: {data},\n\t\t\t\t\tanalyticsLabel,\n\t\t\t\t}\n\t\t\t)\n\t\t\t.then(resolve, reject);\n\t\t});\n\t}\n\n\tstatic createCategory(data: CreateCategoryOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'createCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'create.new.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic getCategory(data: GetCategoryOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'getCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'get.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic updateCategory(data: UpdateCategoryOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'updateCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'update.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic removeCategory(data: RemoveCategoryOptions): Promise<RequestResponse>\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'removeCategory',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'remove.category',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic createRobot(data: CreateRobotOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'createRobot',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'create.robot',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic removeRobot(data: RemoveRobotOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'removeRobot',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'remove.robot',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic getRobotSettingsDialog(data: {[key: string]: any})\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'getRobotSettingsDialog',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'settings.robot'\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic addStage(data: AddStageOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'addStage',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'add.stage',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic removeStage(data: RemoveStageOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'removeStage',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'remove.stage',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic updateStage(data: UpdateStageOptions)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'updateStage',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'update.stage',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic updateStages(data: Array<UpdateStageOptions>)\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'updateStages',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'update.stages',\n\t\t\t},\n\t\t\tdata,\n\t\t});\n\t}\n\n\tstatic getCategories()\n\t{\n\t\treturn Backend.request({\n\t\t\taction: 'getCategories',\n\t\t\tanalyticsLabel: {\n\t\t\t\tcomponent: Backend.component,\n\t\t\t\taction: 'get.categories',\n\t\t\t},\n\t\t});\n\t}\n}","import {Dom} from 'main.core';\nimport {Category} from './category';\n\nexport default class CategoryStub extends Category\n{\n\tconstructor(options)\n\t{\n\t\tsuper(options);\n\t\tDom.addClass(this.getContainer(), 'crm-st-category-stub');\n\n\t\tthis.getAllColumns()\n\t\t\t.forEach((column) => {\n\t\t\t\tcolumn.marker.disable();\n\t\t\t});\n\t}\n}","export default function createStageStubs(count: 0)\n{\n\treturn Array.from({length: count}).map((item, index) => {\n\t\treturn {\n\t\t\tSTATUS_ID: `stub_${index}`,\n\t\t\tCOLOR: 'F1F5F7',\n\t\t\tNAME: 'category stub',\n\t\t};\n\t});\n}","import {Type, Loc} from 'main.core';\n\nexport default function makeErrorMessageFromResponse({data})\n{\n\tif (Type.isArray(data.errors) && data.errors.length > 0)\n\t{\n\t\treturn data.errors.join('<br>');\n\t}\n\n\treturn Loc.getMessage('CRM_ST_SAVE_ERROR');\n}","import {Event, Loc, Cache, Type} from 'main.core';\nimport {PopupWindow, PopupWindowButtonLink} from 'main.popup';\nimport {UI} from 'ui.notification';\nimport {Category} from '../category/category';\nimport Backend from '../backend';\nimport type CategorySourceOptions from '../type/category-source-options';\nimport type TunnelScheme from '../type/tunnel-scheme';\nimport type Link from '../type/link';\nimport CategoryStub from '../category/category-stub';\nimport createStageStubs from './internal/create-stage-stubs';\nimport type Stage, {Tunnel} from '../type/stage';\nimport makeErrorMessageFromResponse from './internal/make-error-message';\n\nexport default class Manager\n{\n\tcategories: Map<number, Category>;\n\n\tconstructor(options: {\n\t\tcontainer: HTMLDivElement,\n\t\taddCategoryButtonTop: HTMLButtonElement,\n\t\thelpButton: HTMLButtonElement,\n\t\tcategories: Array<{[key: string]: number}>,\n\t\ttunnelScheme: TunnelScheme,\n\t\trobotsUrl: string,\n\t\tgeneratorUrl: string,\n\t\tallowWrite: boolean,\n\t\tcanEditTunnels: boolean,\n\t\tcanAddCategory: boolean,\n\t\tcategoriesQuantityLimit: number,\n\t\trestrictionPopupCode: string,\n\t})\n\t{\n\t\tthis.container = options.container;\n\t\tthis.addCategoryButtonTop = options.addCategoryButtonTop;\n\t\tthis.helpButton = options.helpButton;\n\t\tthis.categoriesOptions = options.categories;\n\t\tthis.robotsUrl = options.robotsUrl;\n\t\tthis.generatorUrl = options.generatorUrl;\n\t\tthis.tunnelScheme = options.tunnelScheme;\n\t\tthis.allowWrite = Boolean(options.allowWrite);\n\t\tthis.canEditTunnels = Boolean(options.canEditTunnels);\n\t\tthis.canAddCategory = Boolean(options.canAddCategory);\n\t\tthis.categoriesQuantityLimit = Number(options.categoriesQuantityLimit);\n\t\tthis.restrictionPopupCode = options.restrictionPopupCode;\n\t\tthis.categories = new Map();\n\t\tthis.cache = new Cache.MemoryCache();\n\n\t\tthis.initCategories();\n\t\tthis.initTunnels();\n\n\t\tsetTimeout(() => {\n\t\t\tif (!this.hasTunnels())\n\t\t\t{\n\t\t\t\tthis.showCategoryStub();\n\t\t\t}\n\t\t});\n\n\t\tEvent.bind(this.getAddCategoryButton(), 'click', this.onAddCategoryClick.bind(this));\n\t\tEvent.bind(this.addCategoryButtonTop, 'click', this.onAddCategoryTopClick.bind(this));\n\t\tEvent.bind(this.helpButton, 'click', this.onHelpButtonClick.bind(this));\n\t}\n\n\thasTunnels(): boolean\n\t{\n\t\treturn this.getTunnels().length > 0;\n\t}\n\n\tgetContainer()\n\t{\n\t\treturn this.cache.remember('container', () => {\n\t\t\treturn document.querySelector('.crm-st');\n\t\t});\n\t}\n\n\tgetAppContainer()\n\t{\n\t\treturn this.cache.remember('appContainer', () => {\n\t\t\treturn this.getContainer().querySelector('.crm-st-container');\n\t\t});\n\t}\n\n\tgetCategoriesContainer()\n\t{\n\t\treturn this.cache.remember('categoriesContainer', () => {\n\t\t\treturn this.getAppContainer().querySelector('.crm-st-categories');\n\t\t});\n\t}\n\n\tgetAddCategoryButton()\n\t{\n\t\treturn this.cache.remember('addCategoryButton', () => {\n\t\t\treturn this.getContainer().querySelector('.crm-st-add-category-btn');\n\t\t});\n\t}\n\n\tgetMaxSort()\n\t{\n\t\treturn [...this.categories.values()].reduce((acc, curr) => {\n\t\t\treturn acc > curr.sort ? acc : curr.sort;\n\t\t}, 0);\n\t}\n\n\tonAddCategoryClick(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\tif (\n\t\t\tthis.canAddCategory\n\t\t\t|| this.categoriesQuantityLimit <= 0\n\t\t\t|| this.categoriesQuantityLimit > this.categories.size\n\t\t)\n\t\t{\n\t\t\treturn Backend\n\t\t\t\t.createCategory({\n\t\t\t\t\tname: Loc.getMessage('CRM_ST_TITLE_EDITOR_PLACEHOLDER'),\n\t\t\t\t\tsort: this.getMaxSort() + 10\n\t\t\t\t})\n\t\t\t\t.then((response) => {\n\t\t\t\t\tthis.addCategoryFromOptions(response.data);\n\n\t\t\t\t\tconst allStages = this.getStages();\n\t\t\t\t\tconst newStages = [\n\t\t\t\t\t\t...response.data.STAGES.P,\n\t\t\t\t\t\t...response.data.STAGES.S,\n\t\t\t\t\t\t...response.data.STAGES.F,\n\t\t\t\t\t];\n\n\t\t\t\t\tnewStages.forEach(item => allStages.push(item));\n\n\t\t\t\t\tconst category = this.getCategory(response.data.ID);\n\n\t\t\t\t\tcategory.enableTitleEdit('');\n\t\t\t\t\tcategory.getAllColumns()\n\t\t\t\t\t\t.forEach((column) => {\n\t\t\t\t\t\t\tthis.tunnelScheme.stages.push({\n\t\t\t\t\t\t\t\tcategoryId: column.getData().category.id,\n\t\t\t\t\t\t\t\tstageId: column.getId(),\n\t\t\t\t\t\t\t\tlocked: false,\n\t\t\t\t\t\t\t\ttunnels: [],\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\n\t\t\t\t\tif (this.isShownCategoryStub())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.hideCategoryStub();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\teval(this.restrictionPopupCode);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\t}\n\n\tonAddCategoryTopClick(event)\n\t{\n\t\tthis.onAddCategoryClick(event)\n\t\t\t.then((success) => {\n\t\t\t\tif (success)\n\t\t\t\t{\n\t\t\t\t\twindow.scrollTo(0, document.body.scrollHeight);\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tonHelpButtonClick(event)\n\t{\n\t\tevent.preventDefault();\n\n\t\tif (top.BX.Helper)\n\t\t{\n\t\t\ttop.BX.Helper.show('redirect=detail&code=9474707');\n\t\t}\n\t}\n\n\tgetCategoryStub(): CategoryStub\n\t{\n\t\treturn this.cache.remember('categoryStub', () => {\n\t\t\treturn new CategoryStub({\n\t\t\t\trenderTo: this.getCategoriesContainer(),\n\t\t\t\tappContainer: this.getAppContainer(),\n\t\t\t\tid: 'stub',\n\t\t\t\tname: 'stub',\n\t\t\t\t'default': false,\n\t\t\t\tstages: {\n\t\t\t\t\tP: createStageStubs(5),\n\t\t\t\t\tS: createStageStubs(1),\n\t\t\t\t\tF: createStageStubs(2),\n\t\t\t\t},\n\t\t\t\tsort: 0,\n\t\t\t\trobotsSettingsLink: this.robotsUrl,\n\t\t\t\tgeneratorSettingsLink: this.generatorUrl,\n\t\t\t\tlazy: true,\n\t\t\t});\n\t\t});\n\t}\n\n\tshowCategoryStub()\n\t{\n\t\tthis.shownCategoryStub = true;\n\t\tconst categoryStub = this.getCategoryStub();\n\t\tcategoryStub.draw();\n\n\t\tconst firstCategory = [...this.categories.values()][0];\n\n\t\tconst [columnFrom] = firstCategory.getSuccessKanban().getColumns();\n\t\tconst [columnTo] = categoryStub.getProgressKanban().getColumns();\n\n\t\tcolumnFrom.marker.addStubLinkTo(columnTo.marker, true);\n\t}\n\n\thideCategoryStub()\n\t{\n\t\tthis.shownCategoryStub = false;\n\t\tthis.getCategoryStub()\n\t\t\t.remove();\n\t\tthis.cache.delete('categoryStub');\n\t}\n\n\tisShownCategoryStub(): boolean\n\t{\n\t\treturn this.shownCategoryStub;\n\t}\n\n\tadjustCategoryStub()\n\t{\n\t\tif (!this.hasTunnels())\n\t\t{\n\t\t\tthis.showCategoryStub();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hideCategoryStub();\n\t}\n\n\taddCategoryFromOptions(options: CategorySourceOptions)\n\t{\n\t\tconst category = new Category({\n\t\t\trenderTo: this.getCategoriesContainer(),\n\t\t\tappContainer: this.getAppContainer(),\n\t\t\tid: options.ID,\n\t\t\tname: options.NAME,\n\t\t\t'default': options.IS_DEFAULT,\n\t\t\tstages: options.STAGES,\n\t\t\tsort: options.SORT,\n\t\t\trobotsSettingsLink: this.robotsUrl,\n\t\t\tgeneratorSettingsLink: this.generatorUrl,\n\t\t\tgeneratorsCount: options.RC_COUNT,\n\t\t\tallowWrite: this.allowWrite,\n\t\t\tcanEditTunnels: this.canEditTunnels,\n\t\t});\n\n\t\tcategory\n\t\t\t.subscribe('Category:title:save', (event) => {\n\t\t\t\tconst {categoryId, value} = event.data;\n\n\t\t\t\tBackend\n\t\t\t\t\t.updateCategory({\n\t\t\t\t\t\tid: categoryId,\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tNAME: value,\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t\t.then(({data}) => {\n\t\t\t\t\t\tif (data.success)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse({data}));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Category:remove', (event) => {\n\t\t\t\tBackend\n\t\t\t\t\t.removeCategory({\n\t\t\t\t\t\tid: event.data.categoryId,\n\t\t\t\t\t})\n\t\t\t\t\t.then(({data}) => {\n\t\t\t\t\t\tif (data.success)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.data.onConfirm();\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.data.onCancel();\n\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse({data}));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tif (this.isShownCategoryStub())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.hideCategoryStub();\n\t\t\t\t\t\t\t\tthis.showCategoryStub();\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.adjustCategoryStub();\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Column:link', (event) => {\n\t\t\t\tif (!event.data.preventSave)\n\t\t\t\t{\n\t\t\t\t\tconst from = {\n\t\t\t\t\t\tcategory: event.data.link.from.getData().column.getData().category.id,\n\t\t\t\t\t\tstage: event.data.link.from.getData().column.data.stage.STATUS_ID,\n\t\t\t\t\t};\n\n\t\t\t\t\tconst to = {\n\t\t\t\t\t\tcategory: event.data.link.to.getData().column.getData().category.id,\n\t\t\t\t\t\tstage: event.data.link.to.getData().column.data.stage.STATUS_ID,\n\t\t\t\t\t};\n\n\t\t\t\t\tBackend\n\t\t\t\t\t\t.createRobot({from, to})\n\t\t\t\t\t\t.then((response: {data: {tunnel: Tunnel, success: boolean}}) => {\n\t\t\t\t\t\t\tif (response.data.success)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tconst stage = this.getStages().find((item) => {\n\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\tString(item.CATEGORY_ID) === String(response.data.tunnel.srcCategory)\n\t\t\t\t\t\t\t\t\t\t&& String(item.STATUS_ID) === String(response.data.tunnel.srcStage)\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tstage.TUNNELS.push(response.data.tunnel);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse({data: response.data}));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.hideCategoryStub();\n\t\t\t})\n\t\t\t.subscribe('Column:removeLinkFrom', (event) => {\n\t\t\t\tif (!event.data.preventSave)\n\t\t\t\t{\n\t\t\t\t\tconst columnFrom = event.data.link.from.getData().column;\n\t\t\t\t\tconst columnTo = event.data.link.to.getData().column;\n\t\t\t\t\tconst srcCategory = columnFrom.getData().category.id;\n\t\t\t\t\tconst srcStage = columnFrom.getId();\n\t\t\t\t\tconst dstCategory = columnTo.getData().category.id;\n\t\t\t\t\tconst dstStage = columnTo.getId();\n\t\t\t\t\tconst tunnel = this.getTunnelByLink(event.data.link);\n\n\t\t\t\t\tif (tunnel)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst requestOptions = {\n\t\t\t\t\t\t\tsrcCategory,\n\t\t\t\t\t\t\tsrcStage,\n\t\t\t\t\t\t\tdstCategory,\n\t\t\t\t\t\t\tdstStage,\n\t\t\t\t\t\t\trobot: tunnel.robot,\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tBackend\n\t\t\t\t\t\t\t.removeRobot(requestOptions)\n\t\t\t\t\t\t\t.then(({data}) => {\n\t\t\t\t\t\t\t\tif (data.success)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse({data}));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\tconst stage = this.getStageDataById(srcStage);\n\n\t\t\t\t\t\tstage.TUNNELS = stage.TUNNELS.filter((item) => {\n\t\t\t\t\t\t\treturn !(\n\t\t\t\t\t\t\t\tString(item.srcStage) === String(srcStage)\n\t\t\t\t\t\t\t\t&& String(item.srcCategory) === String(srcCategory)\n\t\t\t\t\t\t\t\t&& String(item.dstStage) === String(dstStage)\n\t\t\t\t\t\t\t\t&& String(item.dstCategory) === String(dstCategory)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.adjustCategoryStub();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.subscribe('Column:editLink', (event) => {\n\t\t\t\tconst tunnel = this.getTunnelByLink(event.data.link);\n\n\t\t\t\t// eslint-disable-next-line\n\t\t\t\tBX.Bizproc.Automation.API.showRobotSettings(\n\t\t\t\t\ttunnel.robot,\n\t\t\t\t\t['crm', 'CCrmDocumentDeal', 'DEAL'],\n\t\t\t\t\ttunnel.srcStage,\n\t\t\t\t\t(robot) => {\n\t\t\t\t\t\ttunnel.robot = robot.serialize();\n\n\t\t\t\t\t\tBackend\n\t\t\t\t\t\t\t.request({\n\t\t\t\t\t\t\t\taction: 'updateRobot',\n\t\t\t\t\t\t\t\tanalyticsLabel: {\n\t\t\t\t\t\t\t\t\tcomponent: Backend.component,\n\t\t\t\t\t\t\t\t\taction: 'update.robot',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdata: tunnel\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.then(({data}) => {\n\t\t\t\t\t\t\t\tif (data.success)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\ttunnel.dstCategory = robot.getProperty('CategoryId');\n\t\t\t\t\t\t\t\t\ttunnel.dstStage = robot.getProperty('StageId');\n\n\t\t\t\t\t\t\t\t\tconst category = this.getCategory(tunnel.dstCategory);\n\t\t\t\t\t\t\t\t\tconst column = category.getKanbanColumn(tunnel.dstStage);\n\n\t\t\t\t\t\t\t\t\tevent.data.link.from.updateLink(event.data.link, column.marker, true);\n\n\t\t\t\t\t\t\t\t\tthis.adjustCategoryStub();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse({data}));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t})\n\t\t\t.subscribe('Category:sort', () => {\n\t\t\t\tconst results = Category.instances\n\t\t\t\t\t.filter(category => category.id !== 'stub')\n\t\t\t\t\t.map((category, index) => {\n\t\t\t\t\t\treturn Backend\n\t\t\t\t\t\t\t.updateCategory({\n\t\t\t\t\t\t\t\tid: category.id,\n\t\t\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\t\t\tSORT: (index+1) * 100,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\tPromise.all(results)\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Column:remove', (event) => {\n\t\t\t\tif (!Type.isNil(event.data.column.data.stageId))\n\t\t\t\t{\n\t\t\t\t\tBackend\n\t\t\t\t\t\t.removeStage({\n\t\t\t\t\t\t\tstatusId: event.data.column.getId(),\n\t\t\t\t\t\t\tstageId: event.data.column.data.stageId,\n\t\t\t\t\t\t\tentityId: event.data.column.data.entityId,\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\t\tif (response.data.success)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tevent.data.onConfirm();\n\t\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tevent.data.onCancel();\n\t\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse({\n\t\t\t\t\t\t\t\t\tdata: response.data,\n\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.subscribe('Column:change', (event) => {\n\t\t\t\tBackend\n\t\t\t\t\t.updateStage({\n\t\t\t\t\t\tstatusId: event.data.column.getId(),\n\t\t\t\t\t\tstageId: event.data.column.data.stageId,\n\t\t\t\t\t\tentityId: event.data.column.data.entityId,\n\t\t\t\t\t\tname: event.data.column.getName(),\n\t\t\t\t\t\tsort: event.data.column.data.stage.SORT,\n\t\t\t\t\t\tcolor: event.data.column.getColor(),\n\t\t\t\t\t})\n\t\t\t\t\t.then(({data}) => {\n\t\t\t\t\t\tif (data.success)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse({data}));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Column:addColumn', (event) => {\n\t\t\t\tBackend\n\t\t\t\t\t.addStage({\n\t\t\t\t\t\tname: event.data.column.getGrid().getMessage('COLUMN_TITLE_PLACEHOLDER'),\n\t\t\t\t\t\tsort: (() => {\n\t\t\t\t\t\t\tconst {column} = event.data;\n\t\t\t\t\t\t\tconst grid = column.getGrid();\n\t\t\t\t\t\t\tconst prevColumn = grid.getPreviousColumnSibling(column);\n\n\t\t\t\t\t\t\treturn Number(prevColumn.data.stage.SORT) + 1;\n\t\t\t\t\t\t})(),\n\t\t\t\t\t\tentityId: (() => {\n\t\t\t\t\t\t\tconst {column} = event.data;\n\t\t\t\t\t\t\tconst grid = column.getGrid();\n\t\t\t\t\t\t\tconst prevColumn = grid.getPreviousColumnSibling(column);\n\n\t\t\t\t\t\t\treturn prevColumn.data.stage.ENTITY_ID;\n\t\t\t\t\t\t})(),\n\t\t\t\t\t})\n\t\t\t\t\t.then(({data}) => {\n\t\t\t\t\t\tif (data.success)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tconst {column} = event.data;\n\t\t\t\t\t\t\tconst {stage} = data;\n\t\t\t\t\t\t\tconst grid = column.getGrid();\n\t\t\t\t\t\t\tconst prevColumn = grid.getPreviousColumnSibling(column);\n\t\t\t\t\t\t\tconst category = this.getCategory(prevColumn.data.category.id);\n\n\t\t\t\t\t\t\tstage.TUNNELS = [];\n\n\t\t\t\t\t\t\tthis.getStages().push(stage);\n\n\t\t\t\t\t\t\tcolumn.setOptions({\n\t\t\t\t\t\t\t\tdata: category.getColumnData(stage),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse({data}));\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t})\n\t\t\t.subscribe('Column:sort', (event) => {\n\t\t\t\tconst sortData = event.data.columns.map((column, index) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tstatusId: column.getId(),\n\t\t\t\t\t\tstageId: column.data.stageId,\n\t\t\t\t\t\tentityId: column.data.entityId,\n\t\t\t\t\t\tname: column.getName(),\n\t\t\t\t\t\tsort: (index + 1) * 100,\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\tBackend\n\t\t\t\t\t.updateStages(sortData)\n\t\t\t\t\t.then(({data}) => {\n\t\t\t\t\t\tconst success = data.every((item) => {\n\t\t\t\t\t\t\treturn item.success;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (success)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcontent: Loc.getMessage('CRM_ST_NOTIFICATION_CHANGES_SAVED'),\n\t\t\t\t\t\t\t\tautoHideDelay: 1500,\n\t\t\t\t\t\t\t\tcategory: 'save',\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse({data}));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t})\n\t\t\t.subscribe('Category:slider:close', () => {\n\t\t\t\tthis.reload();\n\t\t\t})\n\t\t\t.subscribe('Column:error', (event) => {\n\t\t\t\tthis.showErrorPopup(makeErrorMessageFromResponse({\n\t\t\t\t\tdata: {\n\t\t\t\t\t\terrors: [event.data.message],\n\t\t\t\t\t},\n\t\t\t\t}));\n\t\t\t});\n\n\t\tthis.categories.set(String(options.ID), category);\n\t}\n\n\tshowErrorPopup(message)\n\t{\n\t\tif (!this.errorPopup)\n\t\t{\n\t\t\tthis.errorPopup = new PopupWindow({\n\t\t\t\ttitleBar: Loc.getMessage('CRM_ST_ERROR_POPUP_TITLE'),\n\t\t\t\twidth: 350,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tbuttons: [\n\t\t\t\t\tnew PopupWindowButtonLink({\n\t\t\t\t\t\tid: 'close',\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ST_ERROR_POPUP_CLOSE_BUTTON_LABEL'),\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick() {\n\t\t\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t});\n\t\t}\n\n\t\tthis.errorPopup.setContent(message);\n\t\tthis.errorPopup.show();\n\t}\n\n\tgetSlider()\n\t{\n\t\t// eslint-disable-next-line\n\t\treturn BX.SidePanel.Instance.getSlider(\n\t\t\twindow.location.pathname\n\t\t);\n\t}\n\n\treload()\n\t{\n\t\tconst slider = this.getSlider();\n\n\t\tif (slider)\n\t\t{\n\t\t\tslider.reload();\n\t\t}\n\t}\n\n\tgetStageDataById(id: string): Stage\n\t{\n\t\treturn this.getStages().find(stage => String(stage.STATUS_ID) === String(id));\n\t}\n\n\tgetTunnelByLink(link: Link)\n\t{\n\t\tconst columnFrom = link.from.getData().column;\n\t\tconst columnTo = link.to.getData().column;\n\t\tconst srcCategory = columnFrom.getData().category.id;\n\t\tconst srcStage = columnFrom.getId();\n\t\tconst dstCategory = columnTo.getData().category.id;\n\t\tconst dstStage = columnTo.getId();\n\n\t\tconst stageFrom = this.getStageDataById(srcStage);\n\n\t\tif (stageFrom)\n\t\t{\n\t\t\treturn stageFrom.TUNNELS.find((item) => {\n\t\t\t\treturn (\n\t\t\t\t\tString(item.srcCategory) === String(srcCategory)\n\t\t\t\t\t&& String(item.srcStage) === String(srcStage)\n\t\t\t\t\t&& String(item.dstCategory) === String(dstCategory)\n\t\t\t\t\t&& String(item.dstStage) === String(dstStage)\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetCategory(id: number | string): Category\n\t{\n\t\treturn this.categories.get(String(id));\n\t}\n\n\tgetStages(): Array<Stage>\n\t{\n\t\treturn this.cache.remember('allStages', () => {\n\t\t\treturn this.categoriesOptions.reduce((acc, category) => {\n\t\t\t\treturn [\n\t\t\t\t\t...acc,\n\t\t\t\t\t...category.STAGES.P,\n\t\t\t\t\t...category.STAGES.S,\n\t\t\t\t\t...category.STAGES.F,\n\t\t\t\t];\n\t\t\t}, []);\n\t\t});\n\t}\n\n\tgetTunnels(): Array<Tunnel>\n\t{\n\t\treturn this.getStages().reduce((acc, stage) => {\n\t\t\treturn [...acc, ...(stage.TUNNELS || [])];\n\t\t}, []);\n\t}\n\n\tinitCategories()\n\t{\n\t\tthis.categoriesOptions.map((categoryOptions) => {\n\t\t\tthis.addCategoryFromOptions(categoryOptions);\n\t\t});\n\t}\n\n\tinitTunnels()\n\t{\n\t\tthis.getStages()\n\t\t\t.filter((stage) => {\n\t\t\t\treturn Type.isArray(stage.TUNNELS) && stage.TUNNELS.length;\n\t\t\t})\n\t\t\t.forEach((stage) => {\n\t\t\t\tstage.TUNNELS.forEach((tunnel) => {\n\t\t\t\t\tconst categoryFrom = this.getCategory(tunnel.srcCategory);\n\t\t\t\t\tconst categoryTo = this.getCategory(tunnel.dstCategory);\n\n\t\t\t\t\tif (categoryFrom && categoryTo)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst columnFrom = categoryFrom.getKanbanColumn(tunnel.srcStage);\n\t\t\t\t\t\tconst columnTo = categoryTo.getKanbanColumn(tunnel.dstStage);\n\n\t\t\t\t\t\tconst preventEvent = true;\n\t\t\t\t\t\tcolumnFrom.marker.addLinkTo(columnTo.marker, preventEvent);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t}\n}","import Column from './kanban/column';\nimport Grid from './kanban/grid';\nimport Manager from './manager/manager';\n\nexport const Kanban = {\n\tColumn,\n\tGrid,\n};\n\nexport {\n\tManager,\n}\n\n"],"names":["createStub","Tag","render","isLine","value","Type","isArray","length","every","isNumber","isOverlap","line1","line2","Error","a1","Math","min","a2","max","b1","b2","isValidRect","rect","left","top","width","height","makeRelativeRect","rect1","rect2","right","bottom","isRect","getMiddlePoint","middleX","middleY","Grid","Event","EventEmitter","area","Dom","addClass","getContainer","container","column","Marker","adjustLinks","emitter","emit","setTimeout","getColumns","forEach","clearInterval","intervalId","options","onChangeHandler","Kanban","Category","renderTo","canEditColumn","editable","canRemoveColumn","canAddColumn","canSortColumn","columnType","dropzoneType","columns","instances","push","appContainer","id","name","sort","Number","parseInt","generatorsCount","stages","robotsSettingsLink","replace","generatorSettingsLink","cache","Cache","MemoryCache","drawed","allowWrite","Boolean","canEditTunnels","lazy","draw","showGeneratorLinkIcon","dragButton","getDragButton","onbxdragstart","onDragStart","bind","onbxdrag","onDrag","onbxdragstop","onDragStop","jsDD","registerObject","adjustRobotsLinkIcon","getProgressKanban","subscribe","event","getAllColumns","getSuccessKanban","getFailKanban","some","marker","links","size","remember","rectArea","pos","middle","parentNode","querySelectorAll","findIndex","item","find","category","index","getIndex","removeAllLinks","dragOffset","start_y","getRectArea","dragIndex","dragTargetCategory","x","y","style","categoryHeight","curIndex","hasClass","categoryContainer","categoryRectArea","categoryMiddle","transform","getNextCategorySibling","delete","moveBackTop","moveBackBottom","removeClass","requestAnimationFrame","restoreAllLinks","insertBefore","append","parentElement","before","map","a","b","after","JSON","stringify","getTitleContainer","getRobotsLink","getRobotsHelpLink","getGeneratorLink","getGeneratorHelpLink","getProgressContainer","getSuccessContainer","getFailContainer","onClick","BX","Helper","show","Text","encode","Loc","getMessage","getProgressStagesContainer","createGrid","P","stage","Column","STATUS_ID","NAME","color","COLOR","data","getColumnData","getSuccessStagesContainer","S","canRemove","canSort","getFailStagesContainer","F","stageId","ID","entityId","ENTITY_ID","onLink","link","onRemoveLinkFrom","onEditLink","onNameChange","onColorChange","onAddColumn","onRemove","onChange","onSort","onError","stagesGroups","progressStagesGroup","successStagesGroup","failStagesGroup","currentStageGroup","categoryName","getTitle","innerText","onRobotsLinkClick","preventDefault","SidePanel","Instance","open","cacheable","events","onClose","onGeneratorLinkClick","onEditButtonClick","getEditButton","isTitleEditEnabled","disableTitleEdit","saveTitle","enableTitleEdit","titleEditor","getTitleEditor","isString","decode","focus","title","titleLength","setSelectionRange","safeValue","trim","innerHTML","attrs","categoryId","hideTitle","showTitleEditor","activateEditButton","focusOnTitleEditor","showTitle","hideTitleEditor","deactivateEditButton","button","onRemoveButtonClick","String","showConfirmRemovePopup","then","confirm","onConfirm","remove","onCancel","removeBlur","addBlur","progressColumns","successColumn","failColumns","blurLinks","unblurLinks","getAllLinks","columnFrom","from","categoryFrom","getData","columnTo","to","categoryTo","removeLink","getAllStubLinks","removeStubLink","filter","onKeyDown","onTitleEditorKeyDown","onBlur","onTitleEditorBlur","stopPropagation","key","startsWith","getRemoveButton","getActionsButtons","isDrawed","columnId","getId","statusId","Promise","resolve","PopupWindow","overlay","opacity","titleBar","content","buttons","PopupWindowButton","text","className","click","popupWindow","destroy","PopupWindowButtonLink","insertAfter","getRobotsLinkIcon","hasTunnels","showRobotsLinkIcon","hideRobotsLinkIcon","getGeneratorLinkIcon","point","isReceiverIntersecting","exclude","onReceiverDragOut","reduce","acc","add","Set","stubLinks","targets","includes","dispatcher","receiver","getTunnelButton","node","arrow","select","appendChild","arrowMarker","defs","closest","firstChild","preventSave","removeAllStubLinks","addLinkTo","path","getLinkPath","d3","showTunnelButton","attr","clearTimeout","adjustLinksTimeoutIds","intermediateXPoints","linksRoot","getLinksRoot","onDispatcherMouseDown","onMarkerRootMouseUp","onMarkerRootMouseMove","on","disabled","markerRoot","getMarkerRoot","getBoundingClientRect","getMarkerLine","relativeRect","getMarkerRootRect","hovered","getDispatcherRect","getMarkerRootMousePosition","destinationMarker","getDestinationMarker","isEnabled","onReceiverDragOver","emitReceiverDragOutForAll","removeMarkerLine","BaseEvent","isDefaultPrevented","message","PopupMenuWindow","bindElement","items","getTunnelMenuItems","onPopupClose","deactivateTunnelButton","onPopupShow","activateTunnelButton","self","onclick","editLink","close","parentMenu","getParentMenuWindow","removeMenuItem","getParentMenuItem","destination","line","fromId","toId","arrowId","linkNode","menu","getTunnelsListMenu","getMenuItems","addMenuItem","onMouseEnter","highlightLink","onMouseLeave","unhighlightLinks","setTunnelsCounterValue","showTunnelStubButton","newTo","oldTo","isLinked","hidden","isLinkedFrom","getTunnelMenu","visibleLinks","getPopupWindow","isShown","isLinkedStub","getStubTunnelButton","getCategory","contains","Runtime","clone","canEdit","onTunnelButtonMouseEnter","onTunnelButtonMouseLeave","onTunnelButtonClick","isTunnelButtonActive","closeByEsc","menuShowDelay","tunnelButton","tunnelsCounter","getTunnelsCounter","markerRootRect","isFunction","getIntermediateXPoints","prev","curr","abs","target","targetPosition","getPointRect","currentPosition","baseOffset","markerMargin","intermediateX","getNearestIntermediateXPoint","lineOffset","currentPath","mousePosition","getMarkerFromPoint","receiverRect","getReceiverRect","heightOffset","currentName","getName","getDot","getHeader","onMarkerDragStart","onMarkerDragOver","onMarkerDragOut","onMarkerDragEnd","onMarkerLinkFrom","onMarkerStubLinkFrom","onMarkerLinkTo","onMarkerStubLinkTo","onMarkerUnlink","onMarkerUnlinkStub","onMarkerError","onTransitionStart","onTransitionEnd","propertyName","srcElement","isAllowedTransitionProperty","setInterval","onLinkHandler","onRemoveLinkFromHandler","onEditLinkhandler","onNameChangeHandler","onColorChangeHandler","onAddColumnHandler","onRemoveHandler","onErrorHandler","clear","activateDot","activateStubDot","progressRect","successRect","failRect","offset","dataFrom","dataTo","disallowDot","allowDot","highlightDot","unhighlightDot","deactivateDot","deactivateStubDot","isDomNode","dot","header","headerDotted","layout","total","newColumn","getGrid","getNextColumnSibling","setOptions","getConfirmDialog","setContent","util","getTitleTextBox","colorChanged","titleChanged","resetRectAreaTimeoutId","Backend","action","analyticsLabel","reject","ajax","runComponentAction","component","mode","request","CategoryStub","disable","createStageStubs","count","Array","makeErrorMessageFromResponse","errors","join","Manager","addCategoryButtonTop","helpButton","categoriesOptions","categories","robotsUrl","generatorUrl","tunnelScheme","canAddCategory","categoriesQuantityLimit","restrictionPopupCode","Map","initCategories","initTunnels","showCategoryStub","getAddCategoryButton","onAddCategoryClick","onAddCategoryTopClick","onHelpButtonClick","getTunnels","document","querySelector","getAppContainer","values","createCategory","getMaxSort","response","addCategoryFromOptions","allStages","getStages","newStages","STAGES","locked","tunnels","isShownCategoryStub","hideCategoryStub","eval","e","console","error","success","window","scrollTo","body","scrollHeight","getCategoriesContainer","shownCategoryStub","categoryStub","getCategoryStub","firstCategory","addStubLinkTo","IS_DEFAULT","SORT","RC_COUNT","updateCategory","fields","UI","Notification","Center","notify","autoHideDelay","showErrorPopup","removeCategory","adjustCategoryStub","createRobot","CATEGORY_ID","tunnel","srcCategory","srcStage","TUNNELS","dstCategory","dstStage","getTunnelByLink","requestOptions","robot","removeRobot","getStageDataById","Bizproc","Automation","API","showRobotSettings","serialize","getProperty","getKanbanColumn","updateLink","results","all","isNil","removeStage","updateStage","getColor","addStage","grid","prevColumn","getPreviousColumnSibling","sortData","updateStages","reload","set","errorPopup","closeIcon","getSlider","location","pathname","slider","stageFrom","get","categoryOptions","preventEvent"],"mappings":"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"}